"use strict";var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var a=require("typescript");var d=require("stream");var fs=require("fs");var o=require("chalk");var p=require("path");var q=require("chokidar");var File=require("vinyl");var _=require("lodash");var r=require("glob");var t={none:0,error:1,warn:2,trace:3,info:4};var u=(function(){function u(){}u.f=function(a){this.b=a;};u.g=function(a){this.c=a;};u.h=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}console.log.apply(console,[o.gray("["+this.c+"]")].concat(d));};u.j=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<t.info){return;}console.log.apply(console,[o.gray(("["+this.c+"]")+o.blue(" INFO: "))].concat(d));};u.k=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<t.warn){return;}console.log.apply(console,[("["+this.c+"]")+o.yellow(" WARNING: ")].concat(d));};u.l=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<t.error){return;}console.log.apply(console,[("["+this.c+"]")+o.red(" ERROR: ")].concat(d));};u.m=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<t.error){return;}console.log.apply(console,[("["+this.c+"]")+o.gray(" TRACE: ")].concat(d));};u.b=t.none;u.c="logger";return u;}());var TsCore;(function(TsCore){function b(d,e){var f=d.length;var g=e.length;return f>g&&d.substr(f-g,g)===e;}TsCore.b=b;TsCore.c=[".ts",".tsx",".d.ts"];TsCore.d=TsCore.c;function f(a){if(!a){return false;}for(var _i=0,c_1=TsCore.c;_i<c_1.length;_i++){var d=c_1[_i];if(b(a,d)){return true;}}return false;}TsCore.f=f;function g(b){var c=b.getDeclarations();if(c&&c.length>0){if(c[0].kind===a.SyntaxKind.SourceFile){return c[0].getSourceFile();}}return undefined;}TsCore.g=g;function i(b){if(b.kind===a.SyntaxKind.ImportDeclaration){return b.moduleSpecifier;}if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var c=b.moduleReference;if(c.kind===a.SyntaxKind.ExternalModuleReference){return c.expression;}}if(b.kind===a.SyntaxKind.ExportDeclaration){return b.moduleSpecifier;}}TsCore.i=i;function l(b){var c=[];for(var _i=1;_i<arguments.length;_i++){c[_i-1]=arguments[_i];}var d=b.message;if(arguments.length>1){d=n(d,arguments,1);}return {file:undefined,start:undefined,length:undefined,messageText:d,category:b.category,code:b.code};}TsCore.l=l;function n(a,b,c){c=c||0;return a.replace(/{(\d+)}/g,function(a,d){return b[+d+c];});}function o(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ImportClause&&!!b.name||b.kind===a.SyntaxKind.NamespaceImport||b.kind===a.SyntaxKind.ImportSpecifier||b.kind===a.SyntaxKind.ExportSpecifier||b.kind===a.SyntaxKind.ExportAssignment&&b.expression.kind===a.SyntaxKind.Identifier;}TsCore.o=o;function r(b){return b.replace(/\\/g,"/");}TsCore.r=r;function t(a){return a.replace(/\.ts/,".js");}TsCore.t=t;})(TsCore||(TsCore={}));var Utils;(function(Utils){function b(d,e){if(d){for(var i=0,f=d.length;i<f;i++){var g=e(d[i],i);if(g){return g;}}}return undefined;}Utils.b=b;function c(a,b){if(a){for(var _i=0,a_1=a;_i<a_1.length;_i++){var v=a_1[_i];if(v===b){return true;}}}return false;}Utils.c=c;var d=Object.prototype.hasOwnProperty;function n(e,f){return d.call(e,f);}Utils.n=n;function q(a){var b={};for(var c in a){b[c]=a[c];}return b;}Utils.q=q;function t(b,f){var c;if(b){c=[];for(var _i=0,b_1=b;_i<b_1.length;_i++){var v=b_1[_i];c.push(f(v));}}return c;}Utils.t=t;function y(b,c){var d=1;var f={};for(var g in b){f[g]=b[g];}for(var h in c){if(!n(f,h)){f[h]=c[h];}}return f;}Utils.y=y;function z(b,c,d){return b.substr(0,c)+d+b.substr(c+d.length);}Utils.z=z;})(Utils||(Utils={}));var w=(function(){function w(b,e){this.c=b;this.d=e;}w.prototype.e=function(){return this.d;};w.prototype.f=function(){return this.c;};w.prototype.k=function(){return (this.c===a.ExitStatus.Success);};return w;}());var y=(function(){function y(b){var _this=this;this.c={};this.d={};this.e=0;this.f={};this.g=0;this.l={};this.getSourceFile=this.t;this.fileExists=function(c){c=_this.getCanonicalFileName(c);if(!_this.directoryExists(p.dirname(c))){return false;}if(Utils.n(_this.f,c)){return _this.f[c];}_this.g++;return _this.f[c]=_this.r.fileExists(c);};this.o=b;this.r=a.createCompilerHost(this.o);}y.prototype.s=function(){return this.c;};y.prototype.t=function(b,h,j){return this.r.getSourceFile(b,h,j);};y.prototype.writeFile=function(d,e,f,g){this.c[d]=e;};y.prototype.readFile=function(a){if(Utils.n(this.l,a)){u.m("readFile() cache hit: ",a);return this.l[a];}u.m("readFile() Adding to cache: ",a);return this.l[a]=this.r.readFile(a);};y.prototype.getDefaultLibFileName=function(b){return this.r.getDefaultLibFileName(b);};y.prototype.getCurrentDirectory=function(){return this.r.getCurrentDirectory();};y.prototype.getDirectories=function(a){return this.r.getDirectories(a);};y.prototype.getCanonicalFileName=function(b){return this.r.getCanonicalFileName(b);};y.prototype.useCaseSensitiveFileNames=function(){return this.r.useCaseSensitiveFileNames();};y.prototype.getNewLine=function(){return this.r.getNewLine();};y.prototype.directoryExists=function(b){if(Utils.n(this.d,b)){return this.d[b];}this.e++;return this.d[b]=a.sys.directoryExists(b);};return y;}());var z=(function(_super){__extends(z,_super);function z(a){_super.call(this,{objectMode:true});}z.prototype._read=function(){};return z;}(d.Readable));var A=(function(){function A(){}A.prototype.a=function(b){u.h(b);};A.prototype.b=function(c,d){u.h(this.g(c+":",25)+o.magenta(this.f(d.toString(),10)));};A.prototype.c=function(a,e){this.b(a,""+e);};A.prototype.d=function(f,g){this.b(f,(g/1000).toFixed(2)+"s");};A.prototype.e=function(a,c){this.b(a,c.toFixed(2)+"%");};A.prototype.f=function(s,a){while(s.length<a){s=" "+s;}return s;};A.prototype.g=function(s,a){while(s.length<a){s=s+" ";}return s;};return A;}());var B=(function(_super){__extends(B,_super);function B(a){_super.call(this,a);}return B;}(File));var BundlePackageType;(function(BundlePackageType){BundlePackageType[BundlePackageType["None"]=0]="None";BundlePackageType[BundlePackageType["Library"]=1]="Library";BundlePackageType[BundlePackageType["Component"]=2]="Component";})(BundlePackageType||(BundlePackageType={}));var C=(function(){function C(a,d){this.c=undefined;this.b=a;this.c=d;}C.prototype.d=function(){return this.b;};C.prototype.e=function(){return this.c;};return C;}());var D=(function(){function D(){}D.prototype.b=function(c,d){var f=[];return {bundles:b(),errors:f};function b(){var e=[];var g=c["bundles"];if(g){u.j(g);for(var h in g){u.j("Bundle Id: ",h,g[h]);var i=g[h];var k;var m=[];var o={};k=p.join(d,h);if(Utils.n(i,"files")){if(i["files"] instanceof Array){m=Utils.t(i["files"],function(s){return p.join(d,s);});u.j("bundle files: ",m);}else{f.push(TsCore.l({code:6063,category:a.DiagnosticCategory.Error,key:"Bundle_0_files_is_not_an_array_6063",message:"Bundle '{0}' files is not an array."},h));}}else{f.push(TsCore.l({code:6062,category:a.DiagnosticCategory.Error,key:"Bundle_0_requires_an_array_of_files_6062",message:"Bundle '{0}' requires an array of files."},h));}if(Utils.n(i,"config")){o=i.config;}o.package=q(o);e.push({name:k,fileNames:m,config:o});}}return e;}function q(b){var c=0;var d=undefined;var e={"none":0,"library":1,"component":2};if(Utils.n(b,"package")){var f=b["package"];if(typeof (f)==="string"){if(Utils.n(e,f.toLowerCase())){c=e[f.toLowerCase()];}}}if(Utils.n(b,"packageNamespace")){var g=b["packageNamespace"];if(typeof (g)==="string"){d=g;}}return new C(c,d);}};return D;}());var E=(function(){function E(b,c,f){this.G=0;this.L=0;this.Q=0;this.v=b;this.x=c;this.C=f;this.D=this.x.getCompilerOptions();}E.prototype.T=function(c){this.Q=this.G=new Date().getTime();u.h("Compiling project files...");var m=a.getPreEmitDiagnostics(this.x);if(this.D.noEmitOnError&&m.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,m);}this.G=new Date().getTime()-this.G;if(!this.D.noEmit){var o=new Date().getTime();var q=this.x.emit();this.L=new Date().getTime()-o;m=m.concat(q.diagnostics);if(q.emitSkipped){return new w(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,m);}var t=this.v.s();for(var y in t){var z=t[y];var A=new B({path:y,contents:new Buffer(z)});this.C.push(A);}}this.Q=new Date().getTime()-this.Q;if(m.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,m);}if(this.D.diagnostics){this.U();}return new w(a.ExitStatus.Success);};E.prototype.U=function(){var g=new A();g.c("Files",this.x.getSourceFiles().length);g.c("Lines",this.V());g.d("Pre-emit time",this.G);g.d("Emit time",this.L);g.d("Compile time",this.Q);};E.prototype.V=function(){var _this=this;var a=0;Utils.b(this.x.getSourceFiles(),function(b){if(!b.isDeclarationFile){a+=_this.W(b).length;}});return a;};E.prototype.W=function(b){return b.getLineStarts();};return E;}());var F=(function(_super){__extends(F,_super);function F(b,c){var _this=this;_super.call(this,b);this.getSourceFile=function(b,c,d){if(_this.k){var f_1=_this.k.getSourceFile(b);if(f_1&&f_1.fileWatcher){u.m("getSourceFile() watcher hit for: ",b);return f_1;}}u.m("getSourceFile() reading source file from fs: ",b);var e=_super.prototype.t.call(_this,b,c,d);if(e&&_this.o.watch){e.fileWatcher=q.watch(e.fileName);e.fileWatcher.on("change",function(a,b){return _this.v(e,a,b);});}return e;};this.v=c;}F.prototype.x=function(d){this.k=d;};return F;}(y));var G=(function(){function G(){}G.prototype.a=function(b){var g=new r.Glob(b);var c=g.minimatch.set ;if(c.length>1)return true;for(var j=0;j<c[0].length;j++){if(typeof c[0][j]!=='string')return true;}return false;};G.prototype.c=function(e,f){if(e.length===0){return [];}var g=this.d(e,function(a){return r.sync(a,{root:f});});return g;};G.prototype.d=function(c,f){var i=[];_.flatten(c).forEach(function(b){var c;var a;c=_.isString(b)&&b.indexOf("!")===0;if(c){b=b.slice(1);}a=f(b);if(c){return i=_.difference(i,a);}else{return i=_.union(i,a);}});return i;};return G;}());var H=(function(){function H(b,d,e){this.c=b;this.m=d;this.q=e;}H.prototype.s=function(){return this.q;};H.prototype.t=function(){return this.m;};H.prototype.v=function(){return this.c;};H.prototype.w=function(){return (this.c===a.ExitStatus.Success);};return H;}());var I=(function(){function I(d,e){this.h={};this.b=d;this.c=e;this.f=this.c.getCompilerOptions();}I.prototype.m=function(c){var f=this;var h={};var i={};function d(c){c.forEach(function(e){var g=f.t(e);var k=f.v(g);var l=f.b.getCanonicalFileName(k.fileName);if(!Utils.n(i,l)){i[l]=true;if(!k.isDeclarationFile){u.j("Walking Import module: ",l);d(f.o(k));}}if(!Utils.n(h,l)){u.j("Getting and adding imports of module file: ",l);h[l]=f.o(k);}});}var k=f.o(c);d(k);var q=f.b.getCanonicalFileName(c.fileName);if(!Utils.n(h,q)){u.j("Adding top level import dependencies for file: ",q);h[q]=k;}return h;};I.prototype.o=function(b){var d=[];var e=this;function g(f){a.forEachChild(f,function(f){if(f.kind===a.SyntaxKind.ImportDeclaration||f.kind===a.SyntaxKind.ImportEqualsDeclaration||f.kind===a.SyntaxKind.ExportDeclaration){var h=TsCore.i(f);if(h&&h.kind===a.SyntaxKind.StringLiteral){var l=e.c.getTypeChecker().getSymbolAtLocation(h);if(l){u.j("Adding import node: ",l.name);d.push(f);}else{u.k("Module symbol not found");}}}else if(f.kind===a.SyntaxKind.ModuleDeclaration&&f.name.kind===a.SyntaxKind.StringLiteral&&(f.flags&a.NodeFlags.Ambient||b.isDeclarationFile)){var m=f;u.j("Processing ambient module declaration: ",m.name.text);g(f.body);}});};u.j("Getting imports for source file: ",b.fileName);g(b);return d;};I.prototype.q=function(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration&&b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference;};I.prototype.s=function(b){return b.moduleReference.expression;};I.prototype.t=function(b){var d=TsCore.i(b);if(d&&d.kind===a.SyntaxKind.StringLiteral){return this.c.getTypeChecker().getSymbolAtLocation(d);}};I.prototype.v=function(b){var c=b.getDeclarations()[0];return c.getSourceFile();};return I;}());var Ast;(function(Ast){(function(ContainerFlags){ContainerFlags[ContainerFlags["None"]=0]="None";ContainerFlags[ContainerFlags["IsContainer"]=1]="IsContainer";ContainerFlags[ContainerFlags["IsBlockScopedContainer"]=2]="IsBlockScopedContainer";ContainerFlags[ContainerFlags["IsControlFlowContainer"]=4]="IsControlFlowContainer";ContainerFlags[ContainerFlags["IsFunctionLike"]=8]="IsFunctionLike";ContainerFlags[ContainerFlags["IsFunctionExpression"]=16]="IsFunctionExpression";ContainerFlags[ContainerFlags["HasLocals"]=32]="HasLocals";ContainerFlags[ContainerFlags["IsInterface"]=64]="IsInterface";ContainerFlags[ContainerFlags["IsObjectLiteralOrClassExpressionMethod"]=128]="IsObjectLiteralOrClassExpressionMethod";ContainerFlags[ContainerFlags["IsContainerWithLocals"]=33]="IsContainerWithLocals";})(Ast.ContainerFlags||(Ast.ContainerFlags={}));var ContainerFlags=Ast.ContainerFlags;function b(c){if(c.kind!==a.SyntaxKind.BinaryExpression){return false;}var d=c;if(d.operatorToken.kind!==a.SyntaxKind.EqualsToken||d.left.kind!==a.SyntaxKind.PropertyAccessExpression){return false;}var e=d.left;if(e.expression.kind===a.SyntaxKind.PropertyAccessExpression){var f=e.expression;if(f.expression.kind===a.SyntaxKind.Identifier&&f.name.text==="prototype"){return true;}}return false;}Ast.b=b;function c(b){if(b){switch(b.kind){case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.ArrowFunction:case a.SyntaxKind.MethodDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return true;}}return false;}Ast.c=c;function d(e){return e.kind===a.SyntaxKind.MethodDeclaration&&(e.parent.kind===a.SyntaxKind.ObjectLiteralExpression||e.parent.kind===a.SyntaxKind.ClassExpression);}Ast.d=d;function e(b){if(b&&(b.flags&a.SymbolFlags.Interface)){if(b.valueDeclaration){var c=b.valueDeclaration.flags;return false;}}return false;}Ast.e=e;function f(b){if(b&&(b.flags&a.SymbolFlags.Class)){var c=b.valueDeclaration.flags;if(!(c&a.NodeFlags.Export)){return true;}}return false;}Ast.f=f;function g(b){if(b&&b.valueDeclaration){if(b.valueDeclaration.flags&a.NodeFlags.Abstract){return true;}}return false;}Ast.g=g;function h(f,g){var t=[];function e(b,c){var d=b.types;if(d){for(var _i=0,d_1=d;_i<d_1.length;_i++){var f=d_1[_i];var g=c.getTypeAtLocation(f);var h=g.symbol.valueDeclaration;if(h){var j=h.heritageClauses;if(j){for(var _a=0,j_1=j;_a<j_1.length;_a++){var k=j_1[_a];e(k,c);}}}var i=g.getProperties();for(var _b=0,i_1=i;_b<i_1.length;_b++){var l=i_1[_b];if(Ast.x(l)){t.push(l);}}}}}var v=f.heritageClauses;if(v){for(var _i=0,v_1=v;_i<v_1.length;_i++){var w=v_1[_i];e(w,g);}}return t;}Ast.h=h;function l(b,c){var d=[];var e=b.types;for(var _i=0,e_1=e;_i<e_1.length;_i++){var f=e_1[_i];var g=c.getTypeAtLocation(f);var h=g.getSymbol();if(h.valueDeclaration){if(h.valueDeclaration.flags&a.NodeFlags.Abstract){var i=g.getProperties();for(var _a=0,i_2=i;_a<i_2.length;_a++){var j=i_2[_a];d.push(j);}}}}return d;}Ast.l=l;function o(b,c){var d=[];var e=b.types;for(var _i=0,e_2=e;_i<e_2.length;_i++){var f=e_2[_i];var g=c.getTypeAtLocation(f);var h=g.getProperties();for(var _a=0,h_1=h;_a<h_1.length;_a++){var i=h_1[_a];d.push(i);}}return d;}Ast.o=o;function p(b){if(!b){return undefined;}var c=b.id;if(c===undefined&&b.valueDeclaration){c=b.valueDeclaration.symbol.id;}return c?c.toString():undefined;}Ast.p=p;function q(b){switch(b.kind){case a.SyntaxKind.ClassExpression:case a.SyntaxKind.ClassDeclaration:case a.SyntaxKind.EnumDeclaration:case a.SyntaxKind.ObjectLiteralExpression:case a.SyntaxKind.TypeLiteral:case a.SyntaxKind.JSDocTypeLiteral:case a.SyntaxKind.JSDocRecordType:return 1;case a.SyntaxKind.InterfaceDeclaration:return 1|64;case a.SyntaxKind.JSDocFunctionType:case a.SyntaxKind.ModuleDeclaration:case a.SyntaxKind.TypeAliasDeclaration:return 1|32;case a.SyntaxKind.SourceFile:return 1|4|32;case a.SyntaxKind.MethodDeclaration:if(d(b)){return 1|4|32|8|128;}case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return 1|4|32|8;case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.ArrowFunction:return 1|4|32|8|16;case a.SyntaxKind.ModuleBlock:return 4;case a.SyntaxKind.PropertyDeclaration:return b.initializer?4:0;case a.SyntaxKind.CatchClause:case a.SyntaxKind.ForStatement:case a.SyntaxKind.ForInStatement:case a.SyntaxKind.ForOfStatement:case a.SyntaxKind.CaseBlock:return 2;case a.SyntaxKind.Block:return c(b.parent)?0:2;}return 0;}Ast.q=q;function r(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_2=c;_i<c_2.length;_i++){var d=c_2[_i];if(d.token===a.SyntaxKind.ImplementsKeyword){return d;}}}}return undefined;}Ast.r=r;function s(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_3=c;_i<c_3.length;_i++){var d=c_3[_i];if(d.token===a.SyntaxKind.ExtendsKeyword){return d;}}}}return undefined;}Ast.s=s;function t(b){return a.SyntaxKind.FirstKeyword<=b&&b<=a.SyntaxKind.LastKeyword;}Ast.t=t;function v(b){return a.SyntaxKind.FirstPunctuation<=b&&b<=a.SyntaxKind.LastPunctuation;}Ast.v=v;function w(b){return a.SyntaxKind.FirstTriviaToken<=b&&b<=a.SyntaxKind.LastTriviaToken;}Ast.w=w;function x(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.ExportContext){return true;}c=c.parent;}return false;}Ast.x=x;function y(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.Ambient){return true;}c=c.parent;}return false;}Ast.y=y;})(Ast||(Ast={}));var J=(function(){function J(b,c,d){this.B={};this.C=[];this.D=undefined;this.t=b;this.v=c;this.C=[b];this.B[d.e().toString()]=d;}J.prototype.E=function(){return this.v;};J.prototype.F=function(){return this.v.name;};J.prototype.G=function(){var b=this.v.id;if(b===undefined&&this.v.valueDeclaration){b=this.v.valueDeclaration.symbol.id;}return b?b.toString():undefined;};J.prototype.H=function(){return this.B;};J.prototype.I=function(){return this.C;};J.prototype.O=function(b,c){this.C.push(b);if(!Utils.n(this.B,c.e().toString())){this.B[c.e().toString()]=c;}};J.prototype.P=function(){if((this.v.flags&a.SymbolFlags.Alias)>0){if(this.v.declarations[0].kind===a.SyntaxKind.NamespaceImport){return true;}}return false;};J.prototype.Q=function(){if((this.v.flags&a.SymbolFlags.FunctionScopedVariable)>0){var b=this.Y();if(b){return true;}}return false;};J.prototype.R=function(){if((this.v.flags&a.SymbolFlags.BlockScopedVariable)>0){var b=this.Y();if(b){return ((b.parent.flags&a.NodeFlags.Let)!==0)||((b.parent.flags&a.NodeFlags.Const)!==0);}}return false;};J.prototype.S=function(){if((this.v.flags&a.SymbolFlags.FunctionScopedVariable)>0){if(this.v.valueDeclaration.kind===a.SyntaxKind.Parameter){return true;}}return false;};J.prototype.T=function(){return Ast.f(this.v);};J.prototype.U=function(){return Ast.e(this.v);};J.prototype.V=function(b){if(this.v.flags&a.SymbolFlags.Function){if(this.v.valueDeclaration.kind===a.SyntaxKind.FunctionDeclaration){var c=this.v.valueDeclaration.flags;if(Ast.x(this.v)||Ast.y(this.v)){return false;}if(!(c&a.NodeFlags.Export)){return true;}if(b){var d=this.v.valueDeclaration;while(d){if(d.flags&a.NodeFlags.Namespace){var e=d.name.text;if(e!==b){return true;}}d=d.parent;}}}}return false;};J.prototype.W=function(){if((this.v.flags&a.SymbolFlags.Method)>0){if(this.v.valueDeclaration===undefined){return false;}var b=this.v.valueDeclaration.flags;if((b&a.NodeFlags.Private)>0){return true;}var c_4=this.v.parent;if(c_4&&Ast.f(c_4)){if(!Ast.g(c_4)){return true;}}if(c_4&&Ast.e(c_4)){return false;}}return false;};J.prototype.X=function(){if((this.v.flags&a.SymbolFlags.Property)>0){if(this.v.valueDeclaration===undefined){return false;}var b=this.v.valueDeclaration.flags;if((b&a.NodeFlags.Private)>0){return true;}var c_5=this.v.parent;if(c_5&&Ast.f(c_5)){if(!Ast.g(c_5)){return true;}}}return false;};J.prototype.Y=function(){switch(this.t.parent.kind){case a.SyntaxKind.VariableDeclaration:return this.t.parent;case a.SyntaxKind.VariableDeclarationList:u.k("VariableDeclaratioList in getVariableDeclaration() - returning null");break;case a.SyntaxKind.VariableStatement:u.k("VariableStatement in getVariableDeclaration() - returning null");break;}return null;};return J;}());var L=(function(){function L(){}L.c=function(){return this.b++;};L.b=1;return L;}());var K=(function(){function K(b,e,h){this.w=[];this.y=undefined;this.A={};this.B={};this.C={};this.M={};this.N=[];this.P=0;this.d=L.c();this.t=e;if(e&2){this.g=b;this.x=true;this.v=h.T();}else{this.f=this.g=b;this.x=false;this.v=this;}this.z=0;}K.prototype.e=function(){return this.d;};K.prototype.Q=function(b){this.w.push(b);};K.prototype.S=function(){return this.w;};K.prototype.T=function(){return this.v;};K.prototype.U=function(){if(this.x){return this.v.U();}return this.z++;};K.prototype.V=function(){return this.x?this.g:this.f;};K.prototype.W=function(){if(this.f){switch(this.f.kind){case a.SyntaxKind.ClassDeclaration:return this.f.members;case a.SyntaxKind.EnumDeclaration:return this.f.members;default:u.m("Container::getMembers() unprocessed container kind: ",this.f.kind);}}return undefined;};K.prototype.X=function(){if(this.f&&this.t&32){switch(this.f.kind){case a.SyntaxKind.ModuleDeclaration:return this.f.locals;default:u.k("Container::getLocals() unprocessed container kind: ",this.f.kind);}}return undefined;};K.prototype.Y=function(){return this.x;};K.prototype.Z=function(){if(this.t&(1|33)){return true;}return false;};K.prototype.$=function(b){if(b.flags&a.SymbolFlags.Class){this.y=b;}};K.prototype._=function(){return this.y;};K.prototype.ab=function(a){for(var i=0;i<this.w.length;i++){if(a.e()===this.w[i].e())return true;}return false;};return K;}());var M=(function(){function M(){}M.prototype.walk=function(b){this.visitNode(b);};M.prototype.visitNode=function(b){this.walkChildren(b);};M.prototype.walkChildren=function(b){var _this=this;a.forEachChild(b,function(a){return _this.visitNode(a);});};return M;}());var N=(function(){function N(){this.f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_0123456789";}N.prototype.g=function(a){var b=["do","if","in","for","int","let","new","try","var"];var c;while(true){c=this.t(a++);if(b.indexOf(c)>0){continue;}else{return c;}}};N.prototype.t=function(a){var b=a;var c=this.f[b%54];b=Math.floor(b/54);while(b>0){c+=this.f[b%64];b=Math.floor(b/64);}return c;};return N;}());var Debug;(function(Debug){function a(b,c){if(!b){c=c||"Assertion failed";if(typeof Error!=="undefined"){throw new Error(c);}throw c;}}Debug.a=a;})(Debug||(Debug={}));var O=(function(_super){__extends(O,_super);function O(b,c,d){_super.call(this);this.L=[];this.Y={};this.Z={};this.gb=0;this.hb=0;this.t=b;this.v=b.getTypeChecker();this.x=c;this.y=d;this.L=[];this.bb=new N();}O.prototype.transform=function(c){this.f=c;return this.kb(c);};O.prototype.ib=function(c){this.eb=new Date().getTime();this.cb=c.length;var f="";var k=a.SyntaxKind.Unknown;var o=false;var q;var s=a.createScanner(a.ScriptTarget.ES5,false,a.LanguageVariant.Standard,c);while((q=s.scan())!==a.SyntaxKind.EndOfFileToken){o=false;if(Ast.w(q)){o=true;}if(!o){switch(k){case a.SyntaxKind.FunctionKeyword:if(q===a.SyntaxKind.Identifier){f+=" ";}break;case a.SyntaxKind.BreakKeyword:case a.SyntaxKind.ContinueKeyword:case a.SyntaxKind.ReturnKeyword:case a.SyntaxKind.YieldKeyword:if(q!==a.SyntaxKind.SemicolonToken){f+=" ";}break;case a.SyntaxKind.ElseKeyword:if(q!==a.SyntaxKind.OpenBraceToken){f+=" ";}break;}switch(q){case a.SyntaxKind.CaseKeyword:case a.SyntaxKind.ClassKeyword:case a.SyntaxKind.ConstKeyword:case a.SyntaxKind.DeleteKeyword:case a.SyntaxKind.DoKeyword:case a.SyntaxKind.ExportKeyword:case a.SyntaxKind.GetKeyword:case a.SyntaxKind.ImportKeyword:case a.SyntaxKind.LetKeyword:case a.SyntaxKind.NewKeyword:case a.SyntaxKind.SetKeyword:case a.SyntaxKind.StaticKeyword:case a.SyntaxKind.ThrowKeyword:case a.SyntaxKind.TypeOfKeyword:case a.SyntaxKind.VarKeyword:case a.SyntaxKind.VoidKeyword:f+=s.getTokenText()+" ";break;case a.SyntaxKind.ExtendsKeyword:case a.SyntaxKind.InKeyword:case a.SyntaxKind.InstanceOfKeyword:f+=" "+s.getTokenText()+" ";break;case a.SyntaxKind.PlusToken:case a.SyntaxKind.PlusPlusToken:if((k===a.SyntaxKind.PlusToken)||(k===a.SyntaxKind.PlusPlusToken)){f+=" ";}f+=s.getTokenText();break;case a.SyntaxKind.MinusToken:case a.SyntaxKind.MinusMinusToken:if((k===a.SyntaxKind.MinusToken)||(k===a.SyntaxKind.MinusMinusToken)){f+=" ";}f+=s.getTokenText();break;default:f+=s.getTokenText();break;}}if(!o){k=q;}}this.db=f.length;this.eb=new Date().getTime()-this.eb;if(this.x.diagnostics)this.zb();return f;};O.prototype.visitNode=function(b){if(this.yb(b)){_super.prototype.visitNode.call(this,b);this.xb();}else{switch(b.kind){case a.SyntaxKind.Identifier:var c=b;var d=this.v.getSymbolAtLocation(c);if(!d){d=this.jb(c);}if(d){var e=Ast.p(d);if(e===undefined){if(d.flags&a.SymbolFlags.Transient){u.m("Ignoring transient symbol: ",d.name);break;}else{e=a.getSymbolId(d).toString();u.m("Generated symbol id for: ",d.name,e);}}if(Utils.n(this.Z,e)){u.j("Identifier already added: ",d.name,e);var f=this.Z[e];this.Z[e].O(c,this.wb());if(!Utils.n(this.wb().B,e)){this.wb().M[e]=f;}}else{var g=new J(c,d,this.wb());u.j("Adding new identifier: ",g.F(),g.G());this.wb().B[e]=g;this.Z[e]=g;var h=d.getName();if(h.length===1){g.D=h;this.wb().M[e]=g;}this.gb++;}}else{u.k("Identifier does not have a symbol: ",c.text);}break;}_super.prototype.visitNode.call(this,b);}};O.prototype.jb=function(c){var d=this.wb().V();if(d.kind===a.SyntaxKind.FunctionExpression){if(Ast.b(d.parent)){var e=d.parent.left.expression.expression;var f=this.v.getSymbolAtLocation(e);if(f&&f.members){if(Utils.n(f.members,c.text)){u.j("Symbol obtained from prototype function: ",c.text);return f.members[c.text];}}}}return undefined;};O.prototype.kb=function(b){this.fb=new Date().getTime();this.walk(b);this.lb();this.fb=new Date().getTime()-this.fb;if(this.x.diagnostics)this.Ab();return b;};O.prototype.lb=function(){for(var b in this.Y){var c=this.Y[b];var d=[];var e=[];var f=[];var g=Ast.s(c.V());if(g){d=Ast.l(g,this.v);}var i=Ast.r(c.V());if(i){f=Ast.o(i,this.v);}e=Ast.h(c.V(),this.v);var j=e.concat(d,f);c.N=j;}this.mb(this.ab);};O.prototype.mb=function(b){var c=b._();if(c){var g=this.Y[c.name];if(g){var h=g.W();if(h){this.sb(h,g);}}}this.tb(b);var d=b.W();if(d){this.sb(d,b);}var e=b.X();if(e){this.rb(e,b);}for(var i in b.B){var l=b.B[i];this.nb(l,b);}for(var m in b.C){var n=b.C[m];var o=Ast.p(n);var q=this.Z[o];this.nb(q,b);}var f=b.S();for(var j=0;j<f.length;j++){this.mb(f[j]);}};O.prototype.nb=function(a,c){var _this=this;if(this.ob(a)){var d_2=this.pb(c,a);u.m("Identifier shortened: ",a.F(),d_2);var e=a.H();for(var f in e){var g=e[f];g.A[d_2]=true;}Utils.b(a.I(),function(b){_this.qb(b,d_2);});return;}};O.prototype.ob=function(a){if(a.R()||a.Q()||a.T()||a.U()||a.W()||a.X()||a.V(this.y.package.e())||a.S()||a.P()){u.m("Identifier CAN be shortened: ",a.F());return true;}u.m("Identifier CANNOT be shortened: ",a.F());return false;};O.prototype.pb=function(b,c){if(!c.D){var d=c.F();if(d.length===1){c.D=d;}else{while(true){var e=this.bb.g(b.U());Debug.a(e.length<=d.length);if(!Utils.n(b.A,e)){c.D=e;break;}else{u.m("Generated name was excluded: ",e,d);}}this.hb++;}}else{u.m("Identifier already has shortened name: ",c.F(),c.D);}u.j("Identifier shortened name: ",c.F(),c.D);return c.D;};O.prototype.qb=function(b,c){var g=b.text.length;var h=(b.end-b.pos);var k=b.getLeadingTriviaWidth();for(var l=b.pos+k;l<b.pos+h;l++){if(this.f.text[l]===b.text[0])break;}b.text=c;b.end=l+c.length;for(var i=0;i<g;i++){var m=" ";if(i<c.length){m=c[i];}this.f.text=Utils.z(this.f.text,l+i,m);}};O.prototype.rb=function(b,c){for(var d in b){var e=b[d];var f=Ast.p(e.declarations[0].symbol);if(f){var g=this.Z[f];this.nb(g,c);}else{u.k("Container local does not have a UId");}}};O.prototype.sb=function(b,c){for(var d in b){var e=b[d];var f=e.symbol;if(f){var g=Ast.p(f);if(g){var h=this.Z[g];var i=false;for(var j in c.N){var l=h.E();var m=c.N[j];if(l.name===m.name){i=true;h.D=h.F();break;}}if(!i){this.nb(h,c);}}else{u.k("Container member does not have a UId");}}else{u.k("Container member does not have a symbol.");}}};O.prototype.tb=function(b){var c=b._();if(c){var d=this.Y[c.name];if(d){var e=d.W();if(e){for(var f in e){var g=e[f];var h=g.symbol;var i=Ast.p(h);var j=this.Z[i];if(j&&j.D){b.A[j.D]=true;}}}}}for(var k in b.B){var l=b.B[k];this.vb(l,b);}for(var m in b.C){var n=b.C[m];var o=Ast.p(n);var q=this.Z[o];Debug.a(q!==undefined,"Container classifiable identifier symbol not found.");this.vb(q,b);}};O.prototype.ub=function(c){var d=this.x.target;var e={};function f(b){var c=b.S();for(var i=0;i<c.length;i++){var g=c[i];f(g);}for(var h in b.M){var j=b.M[h];if((!j.R)||(d===a.ScriptTarget.ES5)){if(!Utils.n(e,j.G())){e[j.G()]=j;}}}}f(c.T());return e;};O.prototype.vb=function(a,b){var c=a.H();for(var d in c){var e=c[d];var f=this.ub(e);for(var g in f){var h=f[g];if(h.D){b.A[h.D]=true;}}}};O.prototype.wb=function(){return this.L[this.L.length-1];};O.prototype.xb=function(){return this.L.pop();};O.prototype.yb=function(b){var c=Ast.q(b);if(c&(1|2)){var d=new K(b,c,this.wb());var e=b.symbol;if(e&&(e.flags&a.SymbolFlags.Class)){var g=Ast.p(e);if(!Utils.n(this.wb().C,g)){this.wb().C[g]=e;}if(!Utils.n(this.Y,e.name)){this.Y[e.name]=d;}var h=Ast.s(b);if(h){var i=this.v.getSymbolAtLocation(h.types[0].expression);d.$(i);}}var f=this.wb();if(!f){this.ab=d;}else{f.Q(d);}this.L.push(d);return true;}return false;};O.prototype.zb=function(){var a=new A();a.d("Whitespace time",this.eb);a.e("Whitespace reduction",((this.cb-this.db)/this.cb)*100.00);};O.prototype.Ab=function(){var a=new A();a.d("Minify time",this.fb);a.c("Total identifiers",this.gb);a.c("Identifiers shortened",this.hb);};return O;}(M));var P=(function(){function P(){}P.c=function(d){if(!d){return;}for(var i=0;i<d.length;i++){this.d(d[i]);}};P.d=function(b){if(!b){return;}var c="";if(b.file){var f=a.getLineAndCharacterOfPosition(b.file,b.start);c+=o.gray(b.file.fileName+"("+(f.line+1)+","+(f.character+1)+"): ");}var e;switch(b.category){case a.DiagnosticCategory.Error:e=o.red(a.DiagnosticCategory[b.category].toLowerCase());break;case a.DiagnosticCategory.Warning:e=o.yellow(a.DiagnosticCategory[b.category].toLowerCase());break;default:e=o.green(a.DiagnosticCategory[b.category].toLowerCase());}c+=e+" TS"+o.white(b.code+'')+": "+o.grey(a.flattenDiagnosticMessageText(b.messageText,"\n"));u.h(c);};return P;}());var Q=(function(){function Q(d,j,l){this.g=d;this.C(l);this.n=j;}Q.prototype.v=function(){this.n.compilerOptions.watch||false;};Q.prototype.B=function(){return this.m;};Q.prototype.C=function(d){if(this.m){var e_3=d?d.getSourceFiles():undefined;Utils.b(this.m.getSourceFiles(),function(a){if(!(e_3&&Utils.c(e_3,a))){var b=a;if(b.fileWatcher){b.fileWatcher.unwatch(b.fileName);}}});}this.g.x(d);this.m=d;};return Q;}());var R=(function(){function R(b,c){this.y=0;this.z=0;this.D=0;this.G=0;this.J="";this.K="";this.L={};this.M={};this.N={};this.v=b;this.x=c;}R.prototype.O=function(A){var _this=this;this.q=A;this.G=new Date().getTime();var D=new I(this.v,this.x);var F=p.dirname(A.name);if(A.config.outDir){F=p.join(F,A.config.outDir);}var Q=p.join(F,p.basename(A.name));Q=TsCore.r(Q);this.J="";this.K="";this.L={};this.M={};this.N={};var U=false;var V={};var _loop_1=function(){var $=A.fileNames[Z];u.j(">>> Processing bundle file:",$);var ab=this_1.v.getCanonicalFileName(TsCore.r($));u.j("BundleSourceFileName:",ab);var bb=this_1.x.getSourceFile(ab);if(!bb){var eb=TsCore.l({code:6060,category:a.DiagnosticCategory.Error,key:"Bundle_source_file_0_not_found_6060",message:"Bundle source file '{0}' not found."},ab);return {value:new H(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,[eb])};}if(bb.languageVariant==a.LanguageVariant.JSX){U=true;}var cb=new Date().getTime();var db=D.m(bb);this_1.y+=new Date().getTime()-cb;for(fb in db){if(!Utils.n(V,fb)){V[fb]=db[fb];}}cb=new Date().getTime();u.j("Traversing module dependencies for bundle: ",bb.fileName);for(gb in db){u.j("Walking dependency nodes for module: ",gb);hb=db[gb];hb.forEach(function(b){var c=_this.db(b);var d=TsCore.g(c);if(d&&!d.isDeclarationFile){var e=_this.v.getCanonicalFileName(d.fileName);var f=db[e];if(f){_this.Q(b,f);}if(!Utils.n(_this.L,e)){_this._(d);}}else{if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var h=b.name.text;var i=_this.V(b);if(_this.W(i,h)){_this.$(b.getText());}}else{if(b.kind===a.SyntaxKind.ImportDeclaration){_this.X(b);}}}});}this_1._(bb);this_1.z+=new Date().getTime()-cb;};var this_1=this;var fb,gb,hb;for(var Z in A.fileNames){var state_1=_loop_1();if(typeof state_1==="object")return state_1.value;}var W=this.K;if(A.config.package.d()===1){W+="export namespace "+A.config.package.e()+" {\r\n";W+=this.J;W+=" \r\n}";}else{W+=this.J;}var X=U?".tsx":".ts";var Y={path:Q+X,extension:X,text:W};this.G=new Date().getTime()-this.G;if(this.x.getCompilerOptions().diagnostics){this.fb();}return new H(a.ExitStatus.Success,undefined,Y);};R.prototype.Q=function(b,c){for(var _i=0,c_6=c;_i<c_6.length;_i++){var d=c_6[_i];var e=this.db(d);var f=TsCore.g(e);if(f&&!f.isDeclarationFile){var h=this.v.getCanonicalFileName(f.fileName);var i=this.eb(d);if(this.U(b,i)){if(!Utils.n(this.L,h)){this._(f);}}}}};R.prototype.U=function(b,c){var d=this.db(b);var e=this.x.getTypeChecker().getExportsOfModule(d);for(var _i=0,e_4=e;_i<e_4.length;_i++){var f=e_4[_i];var g=this.x.getTypeChecker().getDeclaredTypeOfSymbol(f);var h=this.x.getTypeChecker().getBaseTypes(g);for(var _a=0,h_2=h;_a<h_2.length;_a++){var i=h_2[_a];var k=i.symbol.getName();if(c.indexOf(k)>=0){u.j("Base class inheritance found",k);return true;}}}return false;};R.prototype.V=function(b){if(b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference){var c=b.moduleReference;return c.expression.text;}else{return b.moduleReference.getText();}};R.prototype.W=function(a,b){if(!Utils.n(this.M,a)){this.M[a]={};}var c=this.M[a];if(!Utils.n(c,b)){c[b]=b;return true;}return false;};R.prototype.X=function(c){var _this=this;if(!c.importClause){return;}var d=c.moduleSpecifier.text;var e="import ";var f=false;var g=false;if(c.importClause){if(c.importClause.name&&this.W(d,c.importClause.name.text)){e+=c.importClause.name.text;f=true;}}if(c.importClause.namedBindings){if(c.importClause.namedBindings.kind===a.SyntaxKind.NamespaceImport){if(this.W(d,c.importClause.namedBindings.name.text)){if(f){e+=", ";}e+="* as ";e+=c.importClause.namedBindings.name.text;g=true;}}else{if(f){e+=", ";}e+="{ ";Utils.b(c.importClause.namedBindings.elements,function(a){if(_this.W(d,a.name.text)){if(!g){g=true;}else{e+=", ";}var b=a.propertyName;if(b){e+=b.text+" as "+a.name.text;}else{e+=a.name.text;}}});e+=" }";}}e+=" from ";e+=c.moduleSpecifier.getText();e+=";";if(f||g){this.$(e);}};R.prototype.Y=function(b){var _this=this;u.j("Processing import statements and export declarations in file: ",b.fileName);var c=b.text;a.forEachChild(b,function(b){if(b.kind===a.SyntaxKind.ImportDeclaration||b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ExportDeclaration){u.j("processImportStatements() found import");var f=TsCore.i(b);if(f&&f.kind===a.SyntaxKind.StringLiteral){var g=_this.x.getTypeChecker().getSymbolAtLocation(f);if((g)&&(_this.bb(g)||_this.cb)){u.j("processImportStatements() removing code module symbol.");c=_this.Z(b.pos,b.end,c);}}}else{if(_this.q.config.package.d()===2){if(b.kind===a.SyntaxKind.ModuleDeclaration){var h_3=b;if(h_3.name.getText()!==_this.q.config.package.e()){if(h_3.flags&a.NodeFlags.Export){u.j("Component namespace not package namespace. Removing export modifier.");var k=h_3.modifiers[0];c=_this.Z(k.pos,k.end,c);}}}else{if(b.flags&a.NodeFlags.Export){var l=b.modifiers[0];c=_this.Z(l.pos,l.end,c);}}}}});return c;};R.prototype.Z=function(a,b,c){var d=b-a;var e="";for(var i=0;i<d;i++){e+=" ";}var f=c.substring(0,a);var g=c.substring(b);return f+e+g;};R.prototype.$=function(a){u.j("Entering emitModuleImportDeclaration()");this.K+=a+"\n";};R.prototype._=function(b){u.j("Entering addSourceFile() with: ",b.fileName);if(this.ab(b)){var c=this.Y(b);this.J+=c+"\n";var d=this.v.getCanonicalFileName(b.fileName);this.L[d]=d;}else{if(!Utils.n(this.N,b.fileName)){u.j("Adding definition file to bundle source context: ",b.fileName);this.N[b.fileName]=b.text;}}};R.prototype.ab=function(b){return (b.kind===a.SyntaxKind.SourceFile&&!b.isDeclarationFile);};R.prototype.bb=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.SourceFile)&&!(c.isDeclarationFile));};R.prototype.cb=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.ModuleDeclaration)&&((c.flags&a.NodeFlags.Ambient)>0));};R.prototype.db=function(b){var c=TsCore.i(b);if(c&&c.kind===a.SyntaxKind.StringLiteral){return this.x.getTypeChecker().getSymbolAtLocation(c);}};R.prototype.eb=function(b){var c=[];var d=b.importClause.namedBindings;if(d){switch(d.kind){case a.SyntaxKind.NamespaceImport:break;case a.SyntaxKind.NamedImports:for(var _i=0,_a=d.elements;_i<_a.length;_i++){var e=_a[_i];c.push(e.getText());}break;}}return c;};R.prototype.fb=function(){var a=new A();a.d("Deps gen time",this.y);a.d("Deps walk time",this.z);a.d("Source gen time",this.G);};return R;}());var S=(function(){function S(b,c,d){this.x=0;this.y=0;this.D=0;this.G={};this.l=b;this.m=c;this.q=d;this.v=this.m.getCompilerOptions();}S.prototype.I=function(z,F){var _this=this;u.h("Compiling bundle...");this.y=this.D=new Date().getTime();var K;var L;var M;var N=[];Utils.b(this.m.getSourceFiles(),function(a){N.push(a.fileName);});var Q={};var U;var V=F.minify||false;if(V){var gb_1=p.dirname(z.path);var hb_1=p.basename(z.path,z.extension);K=TsCore.r(p.join(gb_1,hb_1+".min.ts"));}else{K=z.path;}L=z.text;this.G[K]=L;M=a.createSourceFile(K,z.text,this.v.target);N.push(K);Utils.b(this.m.getSourceFiles(),function(a){_this.G[a.fileName]=a.text;});function g(c,d,e,f){Q[c]=d;}function i(c,d,e){if(c===K){return M;}var f=U(c,d,e);return f;}U=this.l.getSourceFile;this.l.getSourceFile=i;this.l.writeFile=g;var W=this.v;W.declaration=F.declaration||this.v.declaration;W.sourceMap=F.sourceMap||this.v.sourceMap;W.noEmit=false;if(V){W.declaration=false;W.removeComments=true;}var X=a.createProgram(N,W,this.l);var Y=a.getPreEmitDiagnostics(X);this.D=new Date().getTime()-this.D;if(this.v.noEmitOnError&&Y.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,Y);}if(V){u.h("Minifying bundle...");var jb=new O(X,W,F);M=jb.transform(M);}this.x=new Date().getTime();var Z=X.emit(M);this.x=new Date().getTime()-this.x;u.j("Streaming vinyl bundle source: ",K);var $=new B({path:K,contents:new Buffer(M.text)});this.q.push($);var _=Y.concat(Z.diagnostics);if(Z.emitSkipped){return new w(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,_);}if(this.v.noEmitOnError&&_.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,_);}var ab=p.dirname(z.path);var bb=p.basename(z.path,z.extension);var cb=V?".min":"";var db=TsCore.r(p.join(ab,bb+cb+".js"));if(Utils.n(Q,db)){var kb=Q[db];if(V){var mb=new O(X,W,F);kb=mb.ib(kb);}u.j("Streaming vinyl js: ",bb);var lb=new B({path:db,contents:new Buffer(kb)});this.q.push(lb);}var eb=TsCore.r(p.join(ab,bb+cb+".d.ts"));if(Utils.n(Q,eb)){u.j("Streaming vinyl d.ts: ",eb);var nb=new B({path:eb,contents:new Buffer(Q[eb])});this.q.push(nb);}var fb=TsCore.r(p.join(ab,bb+cb+".js.map"));if(Utils.n(Q,fb)){u.j("Streaming vinyl js.map: ",fb);var ob=new B({path:fb,contents:new Buffer(Q[fb])});this.q.push(ob);}this.y=new Date().getTime()-this.y;if(this.v.diagnostics)this.J();if(_.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,_);}else{return new w(a.ExitStatus.Success);}};S.prototype.J=function(){var a=new A();a.d("Pre-emit time",this.D);a.d("Emit time",this.x);a.d("Compile time",this.y);};return S;}());var V=(function(){function V(a,b){var _this=this;this.K=0;this.L=0;this.M=0;this.N=0;this.db=function(a,b){_this.U=undefined;_this.fb();};this.eb=function(a,b,c){a.fileWatcher.unwatch(a.fileName);a.fileWatcher=undefined;_this.fb();};this.gb=function(){_this.X=undefined;var a=_this.bb();_this.lb(a);if(_this.U.n.compilerOptions.watch){u.h("Watching for project changes...");}};this.m=a;this.r=b;}V.prototype.Y=function(q){var A=this.cb();if(!A.success){P.c(A.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.U=this.Z(A);u.h("Building Project with: "+o.magenta(""+this.J));u.h("TypeScript compiler version: ",a.version);this.v=q;var G=this.bb();this.lb(G);if(A.compilerOptions.watch){u.h("Watching for project changes...");}else{this.ab();}return G;};V.prototype.Z=function(V){if(V.compilerOptions.watch){if(!this.$()){V.compilerOptions.watch=false;}}var Y=new F(V.compilerOptions,this.eb);return new Q(Y,V);};V.prototype.$=function(){var _this=this;if(!a.sys.watchFile){var b=TsCore.l({code:5001,category:a.DiagnosticCategory.Warning,key:"The_current_node_host_does_not_support_the_0_option_5001",message:"The current node host does not support the '{0}' option."},"-watch");P.d(b);return false;}if(!this.W){this.W=q.watch(this.J);this.W.on("change",function(Y,nb){return _this.db(Y,nb);});}return true;};V.prototype.ab=function(){this.v.push(null);};V.prototype.bb=function(){this.K=this.M=new Date().getTime();if(!this.U){var A=this.cb();if(!A.success){P.c(A.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.U=this.Z(A);}var d=[];var j=this.U.n.fileNames;var l=this.U.n.bundles;var m=this.U.n.compilerOptions;var p=a.createProgram(j,m,this.U.g,this.U.B());this.M=new Date().getTime()-this.M;this.U.C(p);var q=new E(this.U.g,p,this.v);this.L=new Date().getTime();var r=q.T();this.L=new Date().getTime()-this.L;if(!r.k()){P.c(r.e());return r.f();}if(m.listFiles){Utils.b(this.U.B().getSourceFiles(),function(a){u.h(a.fileName);});}this.N=new Date().getTime();var x=new R(this.U.g,this.U.B());var y=new S(this.U.g,this.U.B(),this.v);var z;for(var i=0,D=l.length;i<D;i++){u.h("Building bundle: ",o.cyan(l[i].name));z=x.O(l[i]);if(!z.w()){P.c(z.t());return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}r=y.I(z.s(),l[i].config);if(!r.k()){P.c(r.e());return r.f();}}this.N=new Date().getTime()-this.N;this.K=new Date().getTime()-this.K;if(m.diagnostics){this.mb();}if(d.length>0){return a.ExitStatus.DiagnosticsPresent_OutputsGenerated;}return a.ExitStatus.Success;};V.prototype.cb=function(){var _this=this;try{var o=fs.lstatSync(this.m).isDirectory();}catch(e){var q=TsCore.l({code:6064,category:a.DiagnosticCategory.Error,key:"Cannot_read_project_path_0_6064",message:"Cannot read project path '{0}'."},this.m);return {success:false,errors:[q]};}if(o){this.x=this.m;this.J=p.join(this.m,"tsconfig.json");}else{this.x=p.dirname(this.m);this.J=this.m;}u.j("Reading config file:",this.J);var d=a.readConfigFile(this.J,this.hb);if(d.error){return {success:false,errors:[d.error]};}var f=d.config;u.j("Parsing config file...");var g=a.parseJsonConfigFileContent(f,a.sys,this.x);if(g.errors.length>0){return {success:false,errors:g.errors};}g.fileNames=this.jb(g.fileNames,this.x);if(this.r.convertFiles===true){this.kb(g.fileNames,this.x);}var h=new D();var i=h.b(f,this.x);if(i.errors.length>0){return {success:false,errors:i.errors};}i.bundles.forEach(function(a){a.fileNames=_this.jb(a.fileNames,_this.x);});var k=this.ib(this.r,this.x);if(k.errors.length>0){return {success:false,errors:k.errors};}var n=Utils.y(k.options,g.options);u.j("Compiler options: ",n);return {success:true,compilerOptions:n,fileNames:g.fileNames,bundles:i.bundles};};V.prototype.fb=function(){if(this.X){clearTimeout(this.X);}this.X=setTimeout(this.gb,250);};V.prototype.hb=function(b){return a.sys.readFile(b);};V.prototype.ib=function(b,c){var d=a.parseJsonConfigFileContent(b,a.sys,c);if(d.options.project){var e=TsCore.l({code:5099,category:a.DiagnosticCategory.Error,key:"The_compiler_option_0_is_not_supported_in_this_context_5099",message:"The compiler option '{0}' is not supported in this context."},"--project");d.errors.push(e);}return d;};V.prototype.jb=function(d,e){var f=new G();var g=[];Utils.b(d,function(b){if(!f.a(b)){g.push(p.normalize(b));}});var h=f.c(d,e);var i=[];Utils.b(h,function(a){i.push(p.normalize(a));});return _.union(i,g);};V.prototype.kb=function(a,b){var c="";try{c=fs.readFileSync(this.J,'utf8');if(c!==undefined){var d=JSON.parse(c);var f_2=[];a.forEach(function(a){f_2.push(p.relative(b,a).replace(/\\/g,"/"));});d["files"]=f_2;fs.writeFileSync(this.J,JSON.stringify(d,undefined,4));}}catch(e){u.h(o.yellow("Converting project files failed."));}};V.prototype.lb=function(b){switch(b){case a.ExitStatus.Success:u.h(o.green("Project build completed successfully."));break;case a.ExitStatus.DiagnosticsPresent_OutputsSkipped:u.h(o.red("Build completed with errors."));break;case a.ExitStatus.DiagnosticsPresent_OutputsGenerated:u.h(o.red("Build completed with errors. "+o.italic("Outputs generated.")));break;}};V.prototype.mb=function(){var b=new A();b.a("Total build times...");b.d("Pre-build time",this.M);b.d("Compiling time",this.L);b.d("Bundling time",this.N);b.d("Build time",this.K);};return V;}());var TsProject;(function(TsProject){function src(a,b){if(a===undefined&&typeof a!=='string'){throw new Error("Provide a valid directory or file path to the Typescript project configuration json file.");}b=b||{};b.logLevel=b.logLevel||0;u.f(b.logLevel);u.g("TsProject");var c=new z();var e=new V(a,b);e.Y(c);return c;}TsProject.src=src;})(TsProject=exports.TsProject||(exports.TsProject={}));module.exports=TsProject;