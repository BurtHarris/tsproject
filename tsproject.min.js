"use strict";var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var a=require("typescript");var fs=require("fs");var d=require("stream");var n=require("chalk");var o=require("path");var p=require("chokidar");var File=require("vinyl");var _=require("lodash");var q=require("glob");var r={none:0,error:1,warn:2,trace:3,info:4};var t=(function(){function t(){}t.f=function(a){this.b=a;};t.g=function(a){this.c=a;};t.h=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}console.log.apply(console,[n.gray("["+this.c+"]")].concat(d));};t.j=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<r.info){return;}console.log.apply(console,[n.gray(("["+this.c+"]")+n.blue(" INFO: "))].concat(d));};t.k=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<r.warn){return;}console.log.apply(console,[("["+this.c+"]")+n.yellow(" WARNING: ")].concat(d));};t.l=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<r.error){return;}console.log.apply(console,[("["+this.c+"]")+n.red(" ERROR: ")].concat(d));};t.m=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<r.error){return;}console.log.apply(console,[("["+this.c+"]")+n.gray(" TRACE: ")].concat(d));};t.b=r.none;t.c="logger";return t;}());var TsCore;(function(TsCore){function b(d,e){var f=d.length;var g=e.length;return f>g&&d.substr(f-g,g)===e;}TsCore.b=b;TsCore.c=[".ts",".tsx",".d.ts"];TsCore.d=TsCore.c;function f(a){if(!a){return false;}for(var _i=0,c_1=TsCore.c;_i<c_1.length;_i++){var d=c_1[_i];if(b(a,d)){return true;}}return false;}TsCore.f=f;function g(b){if(b.kind===a.SyntaxKind.ImportDeclaration){return b.moduleSpecifier;}if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var c=b.moduleReference;if(c.kind===a.SyntaxKind.ExternalModuleReference){return c.expression;}}if(b.kind===a.SyntaxKind.ExportDeclaration){return b.moduleSpecifier;}}TsCore.g=g;function i(b){var c=[];for(var _i=1;_i<arguments.length;_i++){c[_i-1]=arguments[_i];}var d=b.message;if(arguments.length>1){d=l(d,arguments,1);}return {file:undefined,start:undefined,length:undefined,messageText:d,category:b.category,code:b.code};}TsCore.i=i;function l(a,b,c){c=c||0;return a.replace(/{(\d+)}/g,function(a,d){return b[+d+c];});}function m(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ImportClause&&!!b.name||b.kind===a.SyntaxKind.NamespaceImport||b.kind===a.SyntaxKind.ImportSpecifier||b.kind===a.SyntaxKind.ExportSpecifier||b.kind===a.SyntaxKind.ExportAssignment&&b.expression.kind===a.SyntaxKind.Identifier;}TsCore.m=m;function n(b){return b.replace(/\\/g,"/");}TsCore.n=n;function q(a){return a.replace(/\.ts/,".js");}TsCore.q=q;})(TsCore||(TsCore={}));var Utils;(function(Utils){function b(d,e){if(d){for(var i=0,f=d.length;i<f;i++){var g=e(d[i],i);if(g){return g;}}}return undefined;}Utils.b=b;function c(a,b){if(a){for(var _i=0,a_1=a;_i<a_1.length;_i++){var v=a_1[_i];if(v===b){return true;}}}return false;}Utils.c=c;var d=Object.prototype.hasOwnProperty;function g(e,f){return d.call(e,f);}Utils.g=g;function l(a){var b={};for(var c in a){b[c]=a[c];}return b;}Utils.l=l;function p(b,f){var c;if(b){c=[];for(var _i=0,b_1=b;_i<b_1.length;_i++){var v=b_1[_i];c.push(f(v));}}return c;}Utils.p=p;function q(b,c){var d=1;var f={};for(var h in b){f[h]=b[h];}for(var i in c){if(!g(f,i)){f[i]=c[i];}}return f;}Utils.q=q;function r(b,c,d){return b.substr(0,c)+d+b.substr(c+d.length);}Utils.r=r;})(Utils||(Utils={}));var u=(function(){function u(b,e){this.c=b;this.d=e;}u.prototype.e=function(){return this.d;};u.prototype.f=function(){return this.c;};u.prototype.k=function(){return (this.c===a.ExitStatus.Success);};return u;}());var w=(function(){function w(b){var _this=this;this.c={};this.d={};this.e=0;this.f={};this.i=0;this.l={};this.getSourceFile=this.r;this.fileExists=function(c){c=_this.getCanonicalFileName(c);if(!_this.s(o.dirname(c))){return false;}if(Utils.g(_this.f,c)){return _this.f[c];}_this.i++;return _this.f[c]=_this.n.fileExists(c);};this.m=b;this.n=a.createCompilerHost(this.m);}w.prototype.q=function(){return this.c;};w.prototype.r=function(b,h,j){return this.n.getSourceFile(b,h,j);};w.prototype.writeFile=function(d,e,f,i){this.c[d]=e;};w.prototype.readFile=function(a){if(Utils.g(this.l,a)){return this.l[a];}return this.l[a]=this.n.readFile(a);};w.prototype.getDefaultLibFileName=function(b){return this.n.getDefaultLibFileName(b);};w.prototype.getCurrentDirectory=function(){return this.n.getCurrentDirectory();};w.prototype.getDirectories=function(a){return this.n.getDirectories(a);};w.prototype.getCanonicalFileName=function(b){return this.n.getCanonicalFileName(b);};w.prototype.useCaseSensitiveFileNames=function(){return this.n.useCaseSensitiveFileNames();};w.prototype.getNewLine=function(){return this.n.getNewLine();};w.prototype.s=function(b){if(Utils.g(this.d,b)){return this.d[b];}this.e++;return this.d[b]=a.sys.directoryExists(b);};return w;}());var y=(function(_super){__extends(y,_super);function y(a){_super.call(this,{objectMode:true});}y.prototype._read=function(){};return y;}(d.Readable));var z=(function(){function z(){}z.prototype.a=function(b){t.h(b);};z.prototype.b=function(c,d){t.h(this.g(c+":",25)+n.magenta(this.f(d.toString(),10)));};z.prototype.c=function(a,e){this.b(a,""+e);};z.prototype.d=function(f,g){this.b(f,(g/1000).toFixed(2)+"s");};z.prototype.e=function(a,c){this.b(a,c.toFixed(2)+"%");};z.prototype.f=function(s,a){while(s.length<a){s=" "+s;}return s;};z.prototype.g=function(s,a){while(s.length<a){s=s+" ";}return s;};return z;}());var A=(function(_super){__extends(A,_super);function A(a){_super.call(this,a);}return A;}(File));var BundlePackageType;(function(BundlePackageType){BundlePackageType[BundlePackageType["None"]=0]="None";BundlePackageType[BundlePackageType["Library"]=1]="Library";BundlePackageType[BundlePackageType["Component"]=2]="Component";})(BundlePackageType||(BundlePackageType={}));var B=(function(){function B(a,d){this.c=undefined;this.b=a;this.c=d;}B.prototype.d=function(){return this.b;};B.prototype.e=function(){return this.c;};return B;}());var C=(function(){function C(){}C.prototype.b=function(c,d){var f=[];return {bundles:b(),errors:f};function b(){var e=[];var h=c["bundles"];if(h){t.j(h);for(var k in h){t.j("Bundle Id: ",k,h[k]);var l=h[k];var m;var r=[];var v={};m=o.join(d,k);if(Utils.g(l,"files")){if(l["files"] instanceof Array){r=Utils.p(l["files"],function(s){return o.join(d,s);});t.j("bundle files: ",r);}else{f.push(TsCore.i({code:6063,category:a.DiagnosticCategory.Error,key:"Bundle_0_files_is_not_an_array_6063",message:"Bundle '{0}' files is not an array."},k));}}else{f.push(TsCore.i({code:6062,category:a.DiagnosticCategory.Error,key:"Bundle_0_requires_an_array_of_files_6062",message:"Bundle '{0}' requires an array of files."},k));}if(Utils.g(l,"config")){v=l.config;}v.package=w(v);e.push({name:m,fileNames:r,config:v});}}return e;}function w(b){var c=0;var d=undefined;var e={"none":0,"library":1,"component":2};if(Utils.g(b,"package")){var f=b["package"];if(typeof (f)==="string"){if(Utils.g(e,f.toLowerCase())){c=e[f.toLowerCase()];}}}if(Utils.g(b,"packageNamespace")){var h=b["packageNamespace"];if(typeof (h)==="string"){d=h;}}return new B(c,d);}};return C;}());var D=(function(){function D(b,c,f){this.B=0;this.C=0;this.F=0;this.l=b;this.s=c;this.v=f;this.x=this.s.getCompilerOptions();}D.prototype.K=function(c){this.F=this.B=new Date().getTime();t.h("Compiling project files...");var m=a.getPreEmitDiagnostics(this.s);if(this.x.noEmitOnError&&m.length>0){return new u(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,m);}this.B=new Date().getTime()-this.B;if(!this.x.noEmit){var p=new Date().getTime();var r=this.s.emit();this.C=new Date().getTime()-p;m=m.concat(r.diagnostics);if(r.emitSkipped){return new u(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,m);}var w=this.l.q();for(var y in w){var z=w[y];var D=new A({path:y,contents:new Buffer(z)});this.v.push(D);}}this.F=new Date().getTime()-this.F;if(m.length>0){return new u(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,m);}if(this.x.diagnostics){this.P();}return new u(a.ExitStatus.Success);};D.prototype.P=function(){var l=new z();l.c("Files",this.s.getSourceFiles().length);l.c("Lines",this.S());l.d("Pre-emit time",this.B);l.d("Emit time",this.C);l.d("Compile time",this.F);};D.prototype.S=function(){var _this=this;var a=0;Utils.b(this.s.getSourceFiles(),function(b){if(!b.isDeclarationFile){a+=_this.T(b).length;}});return a;};D.prototype.T=function(b){return b.getLineStarts();};return D;}());var E=(function(_super){__extends(E,_super);function E(b,c){var _this=this;_super.call(this,b);this.getSourceFile=function(b,c,d){if(_this.k){var f_1=_this.k.getSourceFile(b);if(f_1&&f_1.fileWatcher){return f_1;}}var e=_super.prototype.r.call(_this,b,c,d);if(e&&_this.m.watch){e.fileWatcher=p.watch(e.fileName);e.fileWatcher.on("change",function(a,b){return _this.v(e,a,b);});}return e;};this.v=c;}E.prototype.x=function(d){this.k=d;};return E;}(w));var F=(function(){function F(){}F.prototype.a=function(b){var g=new q.Glob(b);var c=g.minimatch.set ;if(c.length>1)return true;for(var j=0;j<c[0].length;j++){if(typeof c[0][j]!=='string')return true;}return false;};F.prototype.c=function(e,f){if(e.length===0){return [];}var g=this.d(e,function(a){return q.sync(a,{root:f});});return g;};F.prototype.d=function(c,f){var k=[];_.flatten(c).forEach(function(b){var c;var a;c=_.isString(b)&&b.indexOf("!")===0;if(c){b=b.slice(1);}a=f(b);if(c){return k=_.difference(k,a);}else{return k=_.union(k,a);}});return k;};return F;}());var G=(function(){function G(b,d,e){this.c=b;this.l=d;this.m=e;}G.prototype.p=function(){return this.m;};G.prototype.q=function(){return this.l;};G.prototype.r=function(){return this.c;};G.prototype.s=function(){return (this.c===a.ExitStatus.Success);};return G;}());var H=(function(){function H(d,e){this.h={};this.b=d;this.c=e;this.f=this.c.getCompilerOptions();}H.prototype.l=function(c){var f=this;var h={};var k={};function d(c){c.forEach(function(e){var i=f.s(e);var l=f.u(i);var m=f.b.getCanonicalFileName(l.fileName);t.j("Import symbol file name: ",m);if(!Utils.g(k,m)){k[m]=true;d(f.p(l));}if(!Utils.g(h,m)){t.j("Adding module import dependencies for file: ",m);h[m]=f.p(l);}});}var m=f.p(c);d(m);var q=f.b.getCanonicalFileName(c.fileName);if(!Utils.g(h,q)){t.j("Adding top level import dependencies for file: ",q);h[q]=m;}return h;};H.prototype.p=function(b){var d=[];var e=this;function h(f){a.forEachChild(f,function(f){if(f.kind===a.SyntaxKind.ImportDeclaration||f.kind===a.SyntaxKind.ImportEqualsDeclaration||f.kind===a.SyntaxKind.ExportDeclaration){t.j("Found import declaration");var i=TsCore.g(f);if(i&&i.kind===a.SyntaxKind.StringLiteral){var l=e.c.getTypeChecker().getSymbolAtLocation(i);if(l){t.j("Adding import symbol: ",l.name,b.fileName);d.push(f);}else{t.k("Module symbol not found");}}}else if(f.kind===a.SyntaxKind.ModuleDeclaration&&f.name.kind===a.SyntaxKind.StringLiteral&&(f.flags&a.NodeFlags.Ambient||b.isDeclarationFile)){var m=f;t.j("Processing ambient module declaration: ",m.name.text);h(f.body);}});};h(b);return d;};H.prototype.q=function(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration&&b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference;};H.prototype.r=function(b){return b.moduleReference.expression;};H.prototype.s=function(b){var d=TsCore.g(b);if(d&&d.kind===a.SyntaxKind.StringLiteral){return this.c.getTypeChecker().getSymbolAtLocation(d);}};H.prototype.u=function(b){var c=b.getDeclarations()[0];return c.getSourceFile();};return H;}());var Ast;(function(Ast){(function(ContainerFlags){ContainerFlags[ContainerFlags["None"]=0]="None";ContainerFlags[ContainerFlags["IsContainer"]=1]="IsContainer";ContainerFlags[ContainerFlags["IsBlockScopedContainer"]=2]="IsBlockScopedContainer";ContainerFlags[ContainerFlags["IsControlFlowContainer"]=4]="IsControlFlowContainer";ContainerFlags[ContainerFlags["IsFunctionLike"]=8]="IsFunctionLike";ContainerFlags[ContainerFlags["IsFunctionExpression"]=16]="IsFunctionExpression";ContainerFlags[ContainerFlags["HasLocals"]=32]="HasLocals";ContainerFlags[ContainerFlags["IsInterface"]=64]="IsInterface";ContainerFlags[ContainerFlags["IsObjectLiteralOrClassExpressionMethod"]=128]="IsObjectLiteralOrClassExpressionMethod";ContainerFlags[ContainerFlags["IsContainerWithLocals"]=33]="IsContainerWithLocals";})(Ast.ContainerFlags||(Ast.ContainerFlags={}));var ContainerFlags=Ast.ContainerFlags;function b(c){if(c.kind!==a.SyntaxKind.BinaryExpression){return false;}var d=c;if(d.operatorToken.kind!==a.SyntaxKind.EqualsToken||d.left.kind!==a.SyntaxKind.PropertyAccessExpression){return false;}var e=d.left;if(e.expression.kind===a.SyntaxKind.PropertyAccessExpression){var f=e.expression;if(f.expression.kind===a.SyntaxKind.Identifier&&f.name.text==="prototype"){return true;}}return false;}Ast.b=b;function c(b){if(b){switch(b.kind){case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.ArrowFunction:case a.SyntaxKind.MethodDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return true;}}return false;}Ast.c=c;function d(e){return e.kind===a.SyntaxKind.MethodDeclaration&&(e.parent.kind===a.SyntaxKind.ObjectLiteralExpression||e.parent.kind===a.SyntaxKind.ClassExpression);}Ast.d=d;function e(b){if(b&&(b.flags&a.SymbolFlags.Interface)){if(b.valueDeclaration){var c=b.valueDeclaration.flags;return false;}}return false;}Ast.e=e;function f(b){if(b&&(b.flags&a.SymbolFlags.Class)){var c=b.valueDeclaration.flags;if(!(c&a.NodeFlags.Export)){return true;}}return false;}Ast.f=f;function h(b){if(b&&b.valueDeclaration){if(b.valueDeclaration.flags&a.NodeFlags.Abstract){return true;}}return false;}Ast.h=h;function l(f,h){var u=[];function e(b,c){var d=b.types;if(d){for(var _i=0,d_1=d;_i<d_1.length;_i++){var f=d_1[_i];var g=c.getTypeAtLocation(f);var h=g.symbol.valueDeclaration;if(h){var j=h.heritageClauses;if(j){for(var _a=0,j_1=j;_a<j_1.length;_a++){var k=j_1[_a];e(k,c);}}}var i=g.getProperties();for(var _b=0,i_1=i;_b<i_1.length;_b++){var l=i_1[_b];if(Ast.x(l)){u.push(l);}}}}}var v=f.heritageClauses;if(v){for(var _i=0,v_1=v;_i<v_1.length;_i++){var w=v_1[_i];e(w,h);}}return u;}Ast.l=l;function n(b,c){var d=[];var e=b.types;for(var _i=0,e_1=e;_i<e_1.length;_i++){var f=e_1[_i];var g=c.getTypeAtLocation(f);var h=g.getSymbol();if(h.valueDeclaration){if(h.valueDeclaration.flags&a.NodeFlags.Abstract){var i=g.getProperties();for(var _a=0,i_2=i;_a<i_2.length;_a++){var j=i_2[_a];d.push(j);}}}}return d;}Ast.n=n;function o(b,c){var d=[];var e=b.types;for(var _i=0,e_2=e;_i<e_2.length;_i++){var f=e_2[_i];var g=c.getTypeAtLocation(f);var h=g.getProperties();for(var _a=0,h_1=h;_a<h_1.length;_a++){var i=h_1[_a];d.push(i);}}return d;}Ast.o=o;function p(b){if(!b){return undefined;}var c=b.id;if(c===undefined&&b.valueDeclaration){c=b.valueDeclaration.symbol.id;}return c?c.toString():undefined;}Ast.p=p;function q(b){switch(b.kind){case a.SyntaxKind.ClassExpression:case a.SyntaxKind.ClassDeclaration:case a.SyntaxKind.EnumDeclaration:case a.SyntaxKind.ObjectLiteralExpression:case a.SyntaxKind.TypeLiteral:case a.SyntaxKind.JSDocTypeLiteral:case a.SyntaxKind.JSDocRecordType:return 1;case a.SyntaxKind.InterfaceDeclaration:return 1|64;case a.SyntaxKind.JSDocFunctionType:case a.SyntaxKind.ModuleDeclaration:case a.SyntaxKind.TypeAliasDeclaration:return 1|32;case a.SyntaxKind.SourceFile:return 1|4|32;case a.SyntaxKind.MethodDeclaration:if(d(b)){return 1|4|32|8|128;}case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return 1|4|32|8;case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.ArrowFunction:return 1|4|32|8|16;case a.SyntaxKind.ModuleBlock:return 4;case a.SyntaxKind.PropertyDeclaration:return b.initializer?4:0;case a.SyntaxKind.CatchClause:case a.SyntaxKind.ForStatement:case a.SyntaxKind.ForInStatement:case a.SyntaxKind.ForOfStatement:case a.SyntaxKind.CaseBlock:return 2;case a.SyntaxKind.Block:return c(b.parent)?0:2;}return 0;}Ast.q=q;function r(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_2=c;_i<c_2.length;_i++){var d=c_2[_i];if(d.token===a.SyntaxKind.ImplementsKeyword){return d;}}}}return undefined;}Ast.r=r;function s(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_3=c;_i<c_3.length;_i++){var d=c_3[_i];if(d.token===a.SyntaxKind.ExtendsKeyword){return d;}}}}return undefined;}Ast.s=s;function u(b){return a.SyntaxKind.FirstKeyword<=b&&b<=a.SyntaxKind.LastKeyword;}Ast.u=u;function v(b){return a.SyntaxKind.FirstPunctuation<=b&&b<=a.SyntaxKind.LastPunctuation;}Ast.v=v;function w(b){return a.SyntaxKind.FirstTriviaToken<=b&&b<=a.SyntaxKind.LastTriviaToken;}Ast.w=w;function x(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.ExportContext){return true;}c=c.parent;}return false;}Ast.x=x;function y(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.Ambient){return true;}c=c.parent;}return false;}Ast.y=y;})(Ast||(Ast={}));var I=(function(){function I(b,c,d){this.A={};this.B=[];this.C=undefined;this.u=b;this.v=c;this.B=[b];this.A[d.e().toString()]=d;}I.prototype.D=function(){return this.v;};I.prototype.E=function(){return this.v.name;};I.prototype.F=function(){var b=this.v.id;if(b===undefined&&this.v.valueDeclaration){b=this.v.valueDeclaration.symbol.id;}return b?b.toString():undefined;};I.prototype.G=function(){return this.A;};I.prototype.H=function(){return this.B;};I.prototype.N=function(b,c){this.B.push(b);if(!Utils.g(this.A,c.e().toString())){this.A[c.e().toString()]=c;}};I.prototype.O=function(){if((this.v.flags&a.SymbolFlags.Alias)>0){if(this.v.declarations[0].kind===a.SyntaxKind.NamespaceImport){return true;}}return false;};I.prototype.P=function(){if((this.v.flags&a.SymbolFlags.FunctionScopedVariable)>0){var b=this.X();if(b){return true;}}return false;};I.prototype.Q=function(){if((this.v.flags&a.SymbolFlags.BlockScopedVariable)>0){var b=this.X();if(b){return ((b.parent.flags&a.NodeFlags.Let)!==0)||((b.parent.flags&a.NodeFlags.Const)!==0);}}return false;};I.prototype.R=function(){if((this.v.flags&a.SymbolFlags.FunctionScopedVariable)>0){if(this.v.valueDeclaration.kind===a.SyntaxKind.Parameter){return true;}}return false;};I.prototype.S=function(){return Ast.f(this.v);};I.prototype.T=function(){return Ast.e(this.v);};I.prototype.U=function(b){if(this.v.flags&a.SymbolFlags.Function){if(this.v.valueDeclaration.kind===a.SyntaxKind.FunctionDeclaration){var c=this.v.valueDeclaration.flags;if(Ast.x(this.v)||Ast.y(this.v)){return false;}if(!(c&a.NodeFlags.Export)){return true;}if(b){var d=this.v.valueDeclaration;while(d){if(d.flags&a.NodeFlags.Namespace){var e=d.name.text;if(e!==b){return true;}}d=d.parent;}}}}return false;};I.prototype.V=function(){if((this.v.flags&a.SymbolFlags.Method)>0){if(this.v.valueDeclaration===undefined){return false;}var b=this.v.valueDeclaration.flags;if((b&a.NodeFlags.Private)>0){return true;}var c_4=this.v.parent;if(c_4&&Ast.f(c_4)){if(!Ast.h(c_4)){return true;}}if(c_4&&Ast.e(c_4)){return false;}}return false;};I.prototype.W=function(){if((this.v.flags&a.SymbolFlags.Property)>0){if(this.v.valueDeclaration===undefined){return false;}var b=this.v.valueDeclaration.flags;if((b&a.NodeFlags.Private)>0){return true;}var c_5=this.v.parent;if(c_5&&Ast.f(c_5)){if(!Ast.h(c_5)){return true;}}}return false;};I.prototype.X=function(){switch(this.u.parent.kind){case a.SyntaxKind.VariableDeclaration:return this.u.parent;case a.SyntaxKind.VariableDeclarationList:t.k("VariableDeclaratioList in getVariableDeclaration() - returning null");break;case a.SyntaxKind.VariableStatement:t.k("VariableStatement in getVariableDeclaration() - returning null");break;}return null;};return I;}());var K=(function(){function K(){}K.c=function(){return this.b++;};K.b=1;return K;}());var J=(function(){function J(b,e,g){this.w=[];this.y=undefined;this.A={};this.B={};this.L={};this.M={};this.O=[];this.P=0;this.d=K.c();this.u=e;if(e&2){this.h=b;this.x=true;this.v=g.T();}else{this.f=this.h=b;this.x=false;this.v=this;}this.z=0;}J.prototype.e=function(){return this.d;};J.prototype.R=function(b){this.w.push(b);};J.prototype.S=function(){return this.w;};J.prototype.T=function(){return this.v;};J.prototype.U=function(){if(this.x){return this.v.U();}return this.z++;};J.prototype.V=function(){return this.x?this.h:this.f;};J.prototype.W=function(){if(this.f){switch(this.f.kind){case a.SyntaxKind.ClassDeclaration:return this.f.members;case a.SyntaxKind.EnumDeclaration:return this.f.members;default:t.m("Container::getMembers() unprocessed container kind: ",this.f.kind);}}return undefined;};J.prototype.X=function(){if(this.f&&this.u&32){switch(this.f.kind){case a.SyntaxKind.ModuleDeclaration:return this.f.locals;default:t.k("Container::getLocals() unprocessed container kind: ",this.f.kind);}}return undefined;};J.prototype.Y=function(){return this.x;};J.prototype.Z=function(){if(this.u&(1|33)){return true;}return false;};J.prototype.$=function(b){if(b.flags&a.SymbolFlags.Class){this.y=b;}};J.prototype._=function(){return this.y;};J.prototype.ab=function(a){for(var i=0;i<this.w.length;i++){if(a.e()===this.w[i].e())return true;}return false;};return J;}());var L=(function(){function L(){}L.prototype.walk=function(b){this.visitNode(b);};L.prototype.visitNode=function(b){this.walkChildren(b);};L.prototype.walkChildren=function(b){var _this=this;a.forEachChild(b,function(a){return _this.visitNode(a);});};return L;}());var M=(function(){function M(){this.f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_0123456789";}M.prototype.h=function(a){var b=["do","if","in","for","int","let","new","try","var"];var c;while(true){c=this.u(a++);if(b.indexOf(c)>0){continue;}else{return c;}}};M.prototype.u=function(a){var b=a;var c=this.f[b%54];b=Math.floor(b/54);while(b>0){c+=this.f[b%64];b=Math.floor(b/64);}return c;};return M;}());var Debug;(function(Debug){function a(b,c){if(!b){c=c||"Assertion failed";if(typeof Error!=="undefined"){throw new Error(c);}throw c;}}Debug.a=a;})(Debug||(Debug={}));var N=(function(_super){__extends(N,_super);function N(b,c,d){_super.call(this);this.Y=[];this.Z={};this.ab={};this.hb=0;this.ib=0;this.v=b;this.x=b.getTypeChecker();this.y=c;this.K=d;this.Y=[];this.cb=new M();}N.prototype.transform=function(c){this.f=c;return this.lb(c);};N.prototype.jb=function(c){this.fb=new Date().getTime();this.db=c.length;var f="";var k=a.SyntaxKind.Unknown;var m=false;var p;var q=a.createScanner(a.ScriptTarget.ES5,false,a.LanguageVariant.Standard,c);while((p=q.scan())!==a.SyntaxKind.EndOfFileToken){m=false;if(Ast.w(p)){m=true;}if(!m){switch(k){case a.SyntaxKind.FunctionKeyword:if(p===a.SyntaxKind.Identifier){f+=" ";}break;case a.SyntaxKind.BreakKeyword:case a.SyntaxKind.ContinueKeyword:case a.SyntaxKind.ReturnKeyword:case a.SyntaxKind.YieldKeyword:if(p!==a.SyntaxKind.SemicolonToken){f+=" ";}break;case a.SyntaxKind.ElseKeyword:if(p!==a.SyntaxKind.OpenBraceToken){f+=" ";}break;}switch(p){case a.SyntaxKind.CaseKeyword:case a.SyntaxKind.ClassKeyword:case a.SyntaxKind.ConstKeyword:case a.SyntaxKind.DeleteKeyword:case a.SyntaxKind.DoKeyword:case a.SyntaxKind.ExportKeyword:case a.SyntaxKind.GetKeyword:case a.SyntaxKind.ImportKeyword:case a.SyntaxKind.LetKeyword:case a.SyntaxKind.NewKeyword:case a.SyntaxKind.SetKeyword:case a.SyntaxKind.StaticKeyword:case a.SyntaxKind.ThrowKeyword:case a.SyntaxKind.TypeOfKeyword:case a.SyntaxKind.VarKeyword:case a.SyntaxKind.VoidKeyword:f+=q.getTokenText()+" ";break;case a.SyntaxKind.ExtendsKeyword:case a.SyntaxKind.InKeyword:case a.SyntaxKind.InstanceOfKeyword:f+=" "+q.getTokenText()+" ";break;case a.SyntaxKind.PlusToken:case a.SyntaxKind.PlusPlusToken:if((k===a.SyntaxKind.PlusToken)||(k===a.SyntaxKind.PlusPlusToken)){f+=" ";}f+=q.getTokenText();break;case a.SyntaxKind.MinusToken:case a.SyntaxKind.MinusMinusToken:if((k===a.SyntaxKind.MinusToken)||(k===a.SyntaxKind.MinusMinusToken)){f+=" ";}f+=q.getTokenText();break;default:f+=q.getTokenText();break;}}if(!m){k=p;}}this.eb=f.length;this.fb=new Date().getTime()-this.fb;if(this.y.diagnostics)this.Ab();return f;};N.prototype.visitNode=function(b){if(this.zb(b)){_super.prototype.visitNode.call(this,b);this.yb();}else{switch(b.kind){case a.SyntaxKind.Identifier:var c=b;var d=this.x.getSymbolAtLocation(c);if(!d){d=this.kb(c);}if(d){var e=Ast.p(d);if(e===undefined){if(d.flags&a.SymbolFlags.Transient){t.m("Ignoring transient symbol: ",d.name);break;}else{e=a.getSymbolId(d).toString();t.m("Generated symbol id for: ",d.name,e);}}if(Utils.g(this.ab,e)){t.j("Identifier already added: ",d.name,e);var f=this.ab[e];this.ab[e].N(c,this.xb());if(!Utils.g(this.xb().B,e)){this.xb().M[e]=f;}}else{var h=new I(c,d,this.xb());t.j("Adding new identifier: ",h.E(),h.F());this.xb().B[e]=h;this.ab[e]=h;var i=d.getName();if(i.length===1){h.C=i;this.xb().M[e]=h;}this.hb++;}}else{t.k("Identifier does not have a symbol: ",c.text);}break;}_super.prototype.visitNode.call(this,b);}};N.prototype.kb=function(c){var d=this.xb().V();if(d.kind===a.SyntaxKind.FunctionExpression){if(Ast.b(d.parent)){var e=d.parent.left.expression.expression;var f=this.x.getSymbolAtLocation(e);if(f&&f.members){if(Utils.g(f.members,c.text)){t.j("Symbol obtained from prototype function: ",c.text);return f.members[c.text];}}}}return undefined;};N.prototype.lb=function(b){this.gb=new Date().getTime();this.walk(b);this.mb();this.gb=new Date().getTime()-this.gb;if(this.y.diagnostics)this.Bb();return b;};N.prototype.mb=function(){for(var b in this.Z){var c=this.Z[b];var d=[];var e=[];var f=[];var g=Ast.s(c.V());if(g){d=Ast.n(g,this.x);}var h=Ast.r(c.V());if(h){f=Ast.o(h,this.x);}e=Ast.l(c.V(),this.x);var i=e.concat(d,f);c.O=i;}this.nb(this.bb);};N.prototype.nb=function(b){var c=b._();if(c){var g=this.Z[c.name];if(g){var h=g.W();if(h){this.tb(h,g);}}}this.ub(b);var d=b.W();if(d){this.tb(d,b);}var e=b.X();if(e){this.sb(e,b);}for(var i in b.B){var l=b.B[i];this.ob(l,b);}for(var m in b.L){var n=b.L[m];var o=Ast.p(n);var q=this.ab[o];this.ob(q,b);}var f=b.S();for(var j=0;j<f.length;j++){this.nb(f[j]);}};N.prototype.ob=function(a,c){var _this=this;if(this.pb(a)){var d_2=this.qb(c,a);t.m("Identifier shortened: ",a.E(),d_2);var e=a.G();for(var f in e){var g=e[f];g.A[d_2]=true;}Utils.b(a.H(),function(b){_this.rb(b,d_2);});return;}};N.prototype.pb=function(a){if(a.Q()||a.P()||a.S()||a.T()||a.V()||a.W()||a.U(this.K.package.e())||a.R()||a.O()){t.m("Identifier CAN be shortened: ",a.E());return true;}t.m("Identifier CANNOT be shortened: ",a.E());return false;};N.prototype.qb=function(b,c){if(!c.C){var d=c.E();if(d.length===1){c.C=d;}else{while(true){var e=this.cb.h(b.U());Debug.a(e.length<=d.length);if(!Utils.g(b.A,e)){c.C=e;break;}else{t.m("Generated name was excluded: ",e,d);}}this.ib++;}}else{t.m("Identifier already has shortened name: ",c.E(),c.C);}t.j("Identifier shortened name: ",c.E(),c.C);return c.C;};N.prototype.rb=function(b,c){var h=b.text.length;var k=(b.end-b.pos);var l=b.getLeadingTriviaWidth();for(var m=b.pos+l;m<b.pos+k;m++){if(this.f.text[m]===b.text[0])break;}b.text=c;b.end=m+c.length;for(var i=0;i<h;i++){var n=" ";if(i<c.length){n=c[i];}this.f.text=Utils.r(this.f.text,m+i,n);}};N.prototype.sb=function(b,c){for(var d in b){var e=b[d];var f=Ast.p(e.declarations[0].symbol);if(f){var g=this.ab[f];this.ob(g,c);}else{t.k("Container local does not have a UId");}}};N.prototype.tb=function(b,c){for(var d in b){var e=b[d];var f=e.symbol;if(f){var g=Ast.p(f);if(g){var h=this.ab[g];var i=false;for(var j in c.O){var l=h.D();var m=c.O[j];if(l.name===m.name){i=true;h.C=h.E();break;}}if(!i){this.ob(h,c);}}else{t.k("Container member does not have a UId");}}else{t.k("Container member does not have a symbol.");}}};N.prototype.ub=function(b){var c=b._();if(c){var d=this.Z[c.name];if(d){var e=d.W();if(e){for(var f in e){var g=e[f];var h=g.symbol;var i=Ast.p(h);var j=this.ab[i];if(j&&j.C){b.A[j.C]=true;}}}}}for(var k in b.B){var l=b.B[k];this.wb(l,b);}for(var m in b.L){var n=b.L[m];var o=Ast.p(n);var q=this.ab[o];Debug.a(q!==undefined,"Container classifiable identifier symbol not found.");this.wb(q,b);}};N.prototype.vb=function(c){var d=this.y.target;var e={};function f(b){var c=b.S();for(var i=0;i<c.length;i++){var h=c[i];f(h);}for(var j in b.M){var k=b.M[j];if((!k.Q)||(d===a.ScriptTarget.ES5)){if(!Utils.g(e,k.F())){e[k.F()]=k;}}}}f(c.T());return e;};N.prototype.wb=function(a,b){var c=a.G();for(var d in c){var e=c[d];var f=this.vb(e);for(var g in f){var h=f[g];if(h.C){b.A[h.C]=true;}}}};N.prototype.xb=function(){return this.Y[this.Y.length-1];};N.prototype.yb=function(){return this.Y.pop();};N.prototype.zb=function(b){var c=Ast.q(b);if(c&(1|2)){var d=new J(b,c,this.xb());var e=b.symbol;if(e&&(e.flags&a.SymbolFlags.Class)){var h=Ast.p(e);if(!Utils.g(this.xb().L,h)){this.xb().L[h]=e;}if(!Utils.g(this.Z,e.name)){this.Z[e.name]=d;}var i=Ast.s(b);if(i){var j=this.x.getSymbolAtLocation(i.types[0].expression);d.$(j);}}var f=this.xb();if(!f){this.bb=d;}else{f.R(d);}this.Y.push(d);return true;}return false;};N.prototype.Ab=function(){var a=new z();a.d("Whitespace time",this.fb);a.e("Whitespace reduction",((this.db-this.eb)/this.db)*100.00);};N.prototype.Bb=function(){var a=new z();a.d("Minify time",this.gb);a.c("Total identifiers",this.hb);a.c("Identifiers shortened",this.ib);};return N;}(L));var O=(function(){function O(){}O.c=function(d){if(!d){return;}for(var i=0;i<d.length;i++){this.d(d[i]);}};O.d=function(b){if(!b){return;}var c="";if(b.file){var f=a.getLineAndCharacterOfPosition(b.file,b.start);c+=n.gray(b.file.fileName+"("+(f.line+1)+","+(f.character+1)+"): ");}var e;switch(b.category){case a.DiagnosticCategory.Error:e=n.red(a.DiagnosticCategory[b.category].toLowerCase());break;case a.DiagnosticCategory.Warning:e=n.yellow(a.DiagnosticCategory[b.category].toLowerCase());break;default:e=n.green(a.DiagnosticCategory[b.category].toLowerCase());}c+=e+" TS"+n.white(b.code+'')+": "+n.grey(a.flattenDiagnosticMessageText(b.messageText,"\n"));t.h(c);};return O;}());var P=(function(){function P(d,j,o){this.g=d;this.w(o);this.m=j;}P.prototype.u=function(){this.m.compilerOptions.watch||false;};P.prototype.v=function(){return this.l;};P.prototype.w=function(d){if(this.l){var e_3=d?d.getSourceFiles():undefined;Utils.b(this.l.getSourceFiles(),function(a){if(!(e_3&&Utils.c(e_3,a))){var b=a;if(b.fileWatcher){b.fileWatcher.unwatch(b.fileName);}}});}this.g.x(d);this.l=d;};return P;}());var Q=(function(){function Q(b,c){this.y=0;this.A=0;this.B=0;this.C=0;this.F="";this.I="";this.J={};this.L={};this.M={};this.u=b;this.x=c;}Q.prototype.N=function(z){var _this=this;this.r=z;this.C=new Date().getTime();var B=new H(this.u,this.x);var E=o.dirname(z.name);if(z.config.outDir){E=o.join(E,z.config.outDir);}var P=o.join(E,o.basename(z.name));P=TsCore.n(P);this.F="";this.I="";this.J={};this.L={};this.M={};var S=false;var T={};for(var Y in z.fileNames){var Z=z.fileNames[Y];t.j(">>> Processing bundle file:",Z);var $=this.u.getCanonicalFileName(TsCore.n(Z));t.j("BundleSourceFileName:",$);var _=this.x.getSourceFile($);if(!_){var cb=TsCore.i({code:6060,category:a.DiagnosticCategory.Error,key:"Bundle_source_file_0_not_found_6060",message:"Bundle source file '{0}' not found."},$);return new G(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,[cb]);}if(_.languageVariant==a.LanguageVariant.JSX){S=true;}var ab=new Date().getTime();var bb=B.l(_);this.y+=new Date().getTime()-ab;for(var db in bb){if(!Utils.g(T,db)){T[db]=bb[db];}}ab=new Date().getTime();t.j("Traversing source dependencies for: ",_.fileName);for(var eb in bb){bb[eb].forEach(function(b){var c=_this._(b);if(_this.Z(c)){var d=c.getDeclarations()[0];var e=d.getSourceFile();var f=e.fileName;if(!Utils.g(_this.J,f)){_this.X(e);}}else{if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var h=b.name.text;var i=_this.P(b);if(_this.S(i,h)){_this.W(b.getText());}}else{_this.T(b);}}});}this.X(_);this.A+=new Date().getTime()-ab;}var U=this.I;if(z.config.package.d()===1){U+="export namespace "+z.config.package.e()+" {\r\n";U+=this.F;U+=" \r\n}";}else{U+=this.F;}var V=S?".tsx":".ts";var W={path:P+V,extension:V,text:U};this.C=new Date().getTime()-this.C;if(this.x.getCompilerOptions().diagnostics){this.ab();}return new G(a.ExitStatus.Success,undefined,W);};Q.prototype.P=function(b){if(b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference){var c=b.moduleReference;return c.expression.text;}else{return b.moduleReference.getText();}};Q.prototype.S=function(a,b){if(!Utils.g(this.L,a)){this.L[a]={};}var c=this.L[a];if(!Utils.g(c,b)){c[b]=b;return true;}return false;};Q.prototype.T=function(c){var _this=this;if(!c.importClause){return;}var d=c.moduleSpecifier.text;var e="import ";var f=false;var g=false;if(c.importClause){if(c.importClause.name&&this.S(d,c.importClause.name.text)){e+=c.importClause.name.text;f=true;}}if(c.importClause.namedBindings){if(c.importClause.namedBindings.kind===a.SyntaxKind.NamespaceImport){if(this.S(d,c.importClause.namedBindings.name.text)){if(f){e+=", ";}e+="* as ";e+=c.importClause.namedBindings.name.text;g=true;}}else{if(f){e+=", ";}e+="{ ";Utils.b(c.importClause.namedBindings.elements,function(a){if(_this.S(d,a.name.text)){if(!g){g=true;}else{e+=", ";}var b=a.propertyName;if(b){e+=b.text+" as "+a.name.text;}else{e+=a.name.text;}}});e+=" }";}}e+=" from ";e+=c.moduleSpecifier.getText();e+=";";if(f||g){this.W(e);}};Q.prototype.U=function(b){var _this=this;t.j("Processing import statements and export declarations in file: ",b.fileName);var c=b.text;a.forEachChild(b,function(b){if(b.kind===a.SyntaxKind.ImportDeclaration||b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ExportDeclaration){t.j("processImportStatements() found import");var f=TsCore.g(b);if(f&&f.kind===a.SyntaxKind.StringLiteral){var h=_this.x.getTypeChecker().getSymbolAtLocation(f);if((h)&&(_this.Z(h)||_this.$)){t.j("processImportStatements() removing code module symbol.");c=_this.V(b.pos,b.end,c);}}}else{if(_this.r.config.package.d()===2){if(b.kind===a.SyntaxKind.ModuleDeclaration){var i_3=b;if(i_3.name.getText()!==_this.r.config.package.e()){if(i_3.flags&a.NodeFlags.Export){t.j("Component namespace not package namespace. Removing export modifier.");var k=i_3.modifiers[0];c=_this.V(k.pos,k.end,c);}}}else{if(b.flags&a.NodeFlags.Export){var l=b.modifiers[0];c=_this.V(l.pos,l.end,c);}}}}});return c;};Q.prototype.V=function(a,b,c){var d=b-a;var e="";for(var i=0;i<d;i++){e+=" ";}var f=c.substring(0,a);var g=c.substring(b);return f+e+g;};Q.prototype.W=function(a){t.j("Entering emitModuleImportDeclaration()");this.I+=a+"\n";};Q.prototype.X=function(b){t.j("Entering addSourceFile() with: ",b.fileName);if(this.Y(b)){var c=this.U(b);this.F+=c+"\n";this.J[b.fileName]=b.fileName;}else{if(!Utils.g(this.M,b.fileName)){t.j("Adding definition file to bundle source context: ",b.fileName);this.M[b.fileName]=b.text;}}};Q.prototype.Y=function(b){return (b.kind===a.SyntaxKind.SourceFile&&!b.isDeclarationFile);};Q.prototype.Z=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.SourceFile)&&!(c.isDeclarationFile));};Q.prototype.$=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.ModuleDeclaration)&&((c.flags&a.NodeFlags.Ambient)>0));};Q.prototype._=function(b){var c=TsCore.g(b);if(c&&c.kind===a.SyntaxKind.StringLiteral){return this.x.getTypeChecker().getSymbolAtLocation(c);}};Q.prototype.ab=function(){var a=new z();a.d("Deps gen time",this.y);a.d("Deps walk time",this.A);a.d("Source gen time",this.C);};return Q;}());var R=(function(){function R(b,c,d){this.C=0;this.F=0;this.H=0;this.I={};this.l=b;this.r=c;this.x=d;this.B=this.r.getCompilerOptions();}R.prototype.J=function(y,E){var _this=this;t.h("Compiling bundle...");this.F=this.H=new Date().getTime();var M;var P;var S;var T=[];Utils.b(this.r.getSourceFiles(),function(a){T.push(a.fileName);});var U={};var V;var W=E.minify||false;if(W){var hb_1=o.dirname(y.path);var ib_1=o.basename(y.path,y.extension);M=TsCore.n(o.join(hb_1,ib_1+".min.ts"));}else{M=y.path;}P=y.text;this.I[M]=P;S=a.createSourceFile(M,y.text,this.B.target);T.push(M);Utils.b(this.r.getSourceFiles(),function(a){_this.I[a.fileName]=a.text;});function i(c,d,e,f){U[c]=d;}function k(c,d,e){if(c===M){return S;}var f=V(c,d,e);return f;}V=this.l.getSourceFile;this.l.getSourceFile=k;this.l.writeFile=i;var X=this.B;X.declaration=E.declaration||this.B.declaration;X.sourceMap=E.sourceMap||this.B.sourceMap;X.noEmit=false;if(W){X.declaration=false;X.removeComments=true;}var Y=a.createProgram(T,X,this.l);var Z=a.getPreEmitDiagnostics(Y);this.H=new Date().getTime()-this.H;if(this.B.noEmitOnError&&Z.length>0){return new u(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,Z);}if(W){t.h("Minifying bundle...");var kb=new N(Y,X,E);S=kb.transform(S);}this.C=new Date().getTime();var $=Y.emit(S);this.C=new Date().getTime()-this.C;t.j("Streaming vinyl bundle source: ",M);var _=new A({path:M,contents:new Buffer(S.text)});this.x.push(_);var ab=Z.concat($.diagnostics);if($.emitSkipped){return new u(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,ab);}if(this.B.noEmitOnError&&ab.length>0){return new u(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,ab);}var bb=o.dirname(y.path);var cb=o.basename(y.path,y.extension);var db=W?".min":"";var eb=TsCore.n(o.join(bb,cb+db+".js"));if(Utils.g(U,eb)){var lb=U[eb];if(W){var nb=new N(Y,X,E);lb=nb.jb(lb);}t.j("Streaming vinyl js: ",cb);var mb=new A({path:eb,contents:new Buffer(lb)});this.x.push(mb);}var fb=TsCore.n(o.join(bb,cb+db+".d.ts"));if(Utils.g(U,fb)){t.j("Streaming vinyl d.ts: ",fb);var ob=new A({path:fb,contents:new Buffer(U[fb])});this.x.push(ob);}var gb=TsCore.n(o.join(bb,cb+db+".js.map"));if(Utils.g(U,gb)){t.j("Streaming vinyl js.map: ",gb);var pb=new A({path:gb,contents:new Buffer(U[gb])});this.x.push(pb);}this.F=new Date().getTime()-this.F;if(this.B.diagnostics)this.L();if(ab.length>0){return new u(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,ab);}else{return new u(a.ExitStatus.Success);}};R.prototype.L=function(){var a=new z();a.d("Pre-emit time",this.H);a.d("Emit time",this.C);a.d("Compile time",this.F);};return R;}());var S=(function(){function S(a,b){var _this=this;this.B=0;this.H=0;this.I=0;this.L=0;this.ab=function(a,b){_this.M=undefined;_this.cb();};this.bb=function(a,b,c){a.fileWatcher.unwatch(a.fileName);a.fileWatcher=undefined;_this.cb();};this.db=function(){_this.U=undefined;var a=_this.Z();_this.ib(a);if(_this.M.m.compilerOptions.watch){t.h("Watching for project changes...");}};this.l=a;this.r=b;}S.prototype.V=function(z){var F=this.$();if(!F.success){O.c(F.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.M=this.W(F);t.h("Building Project with: "+n.magenta(""+this.A));t.h("TypeScript compiler version: ",a.version);this.u=z;var T=this.Z();this.ib(T);if(F.compilerOptions.watch){t.h("Watching for project changes...");}else{this.Y();}return T;};S.prototype.W=function(S){if(S.compilerOptions.watch){if(!this.X()){S.compilerOptions.watch=false;}}var V=new E(S.compilerOptions,this.bb);return new P(V,S);};S.prototype.X=function(){var _this=this;if(!a.sys.watchFile){var b=TsCore.i({code:5001,category:a.DiagnosticCategory.Warning,key:"The_current_node_host_does_not_support_the_0_option_5001",message:"The current node host does not support the '{0}' option."},"-watch");O.d(b);return false;}if(!this.T){this.T=p.watch(this.A);this.T.on("change",function(V,kb){return _this.ab(V,kb);});}return true;};S.prototype.Y=function(){this.u.push(null);};S.prototype.Z=function(){this.B=this.I=new Date().getTime();if(!this.M){var E=this.$();if(!E.success){O.c(E.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.M=this.W(E);}var d=[];var j=this.M.m.fileNames;var l=this.M.m.bundles;var o=this.M.m.compilerOptions;var r=a.createProgram(j,o,this.M.g,this.M.v());this.I=new Date().getTime()-this.I;this.M.w(r);var x=new D(this.M.g,r,this.u);this.H=new Date().getTime();var y=x.K();this.H=new Date().getTime()-this.H;if(!y.k()){O.c(y.e());return y.f();}if(o.listFiles){Utils.b(this.M.v().getSourceFiles(),function(a){t.h(a.fileName);});}this.L=new Date().getTime();var z=new Q(this.M.g,this.M.v());var A=new R(this.M.g,this.M.v(),this.u);var C;for(var i=0,F=l.length;i<F;i++){t.h("Building bundle: ",n.cyan(l[i].name));C=z.N(l[i]);if(!C.s()){O.c(C.q());return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}y=A.J(C.p(),l[i].config);if(!y.k()){O.c(y.e());return y.f();}}this.L=new Date().getTime()-this.L;this.B=new Date().getTime()-this.B;if(o.diagnostics){this.jb();}if(d.length>0){return a.ExitStatus.DiagnosticsPresent_OutputsGenerated;}return a.ExitStatus.Success;};S.prototype.$=function(){var _this=this;try{var p=fs.lstatSync(this.l).isDirectory();}catch(e){var s=TsCore.i({code:6064,category:a.DiagnosticCategory.Error,key:"Cannot_read_project_path_0_6064",message:"Cannot read project path '{0}'."},this.l);return {success:false,errors:[s]};}if(p){this.x=this.l;this.A=o.join(this.l,"tsconfig.json");}else{this.x=o.dirname(this.l);this.A=this.l;}t.j("Reading config file:",this.A);var d=a.readConfigFile(this.A,this.eb);if(d.error){return {success:false,errors:[d.error]};}var f=d.config;t.j("Parsing config file...");var g=a.parseJsonConfigFileContent(f,a.sys,this.x);if(g.errors.length>0){return {success:false,errors:g.errors};}g.fileNames=this.gb(g.fileNames,this.x);if(this.r.convertFiles===true){this.hb(g.fileNames,this.x);}var h=new C();var k=h.b(f,this.x);if(k.errors.length>0){return {success:false,errors:k.errors};}k.bundles.forEach(function(a){a.fileNames=_this.gb(a.fileNames,_this.x);});var m=this.fb(this.r,this.x);if(m.errors.length>0){return {success:false,errors:m.errors};}var n=Utils.q(m.options,g.options);t.j("Compiler options: ",n);return {success:true,compilerOptions:n,fileNames:g.fileNames,bundles:k.bundles};};S.prototype.cb=function(){if(this.U){clearTimeout(this.U);}this.U=setTimeout(this.db,250);};S.prototype.eb=function(b){return a.sys.readFile(b);};S.prototype.fb=function(b,c){var d=a.parseJsonConfigFileContent(b,a.sys,c);if(d.options.project){var e=TsCore.i({code:5099,category:a.DiagnosticCategory.Error,key:"The_compiler_option_0_is_not_supported_in_this_context_5099",message:"The compiler option '{0}' is not supported in this context."},"--project");d.errors.push(e);}return d;};S.prototype.gb=function(d,e){var f=new F();var g=[];Utils.b(d,function(b){if(!f.a(b)){g.push(o.normalize(b));}});var h=f.c(d,e);var i=[];Utils.b(h,function(a){i.push(o.normalize(a));});return _.union(i,g);};S.prototype.hb=function(a,b){var c="";try{c=fs.readFileSync(this.A,'utf8');if(c!==undefined){var d=JSON.parse(c);var f_2=[];a.forEach(function(a){f_2.push(o.relative(b,a).replace(/\\/g,"/"));});d["files"]=f_2;fs.writeFileSync(this.A,JSON.stringify(d,undefined,4));}}catch(e){t.h(n.yellow("Converting project files failed."));}};S.prototype.ib=function(b){switch(b){case a.ExitStatus.Success:t.h(n.green("Project build completed successfully."));break;case a.ExitStatus.DiagnosticsPresent_OutputsSkipped:t.h(n.red("Build completed with errors."));break;case a.ExitStatus.DiagnosticsPresent_OutputsGenerated:t.h(n.red("Build completed with errors. "+n.italic("Outputs generated.")));break;}};S.prototype.jb=function(){var b=new z();b.a("Total build times...");b.d("Pre-build time",this.I);b.d("Compiling time",this.H);b.d("Bundling time",this.L);b.d("Build time",this.B);};return S;}());var TsProject;(function(TsProject){function src(a,b){if(a===undefined&&typeof a!=='string'){throw new Error("Provide a valid directory or file path to the Typescript project configuration json file.");}b=b||{};b.logLevel=b.logLevel||0;t.f(b.logLevel);t.g("TsProject");var c=new y();var e=new S(a,b);e.V(c);return c;}TsProject.src=src;})(TsProject=exports.TsProject||(exports.TsProject={}));module.exports=TsProject;