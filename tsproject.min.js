"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=Object.setPrototypeOf||({__proto__:[]} instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();Object.defineProperty(exports,"__esModule",{value:true});var a=require("typescript");var d=require("stream");var o=require("fs");var p=require("chalk");var q=require("chokidar");var r=require("path");var File=require("vinyl");var _=require("lodash");var t=require("glob");exports.u={none:0,error:1,warn:2,trace:3,info:4};var w=(function(){function w(){}w.f=function(a){this.b=a;};w.g=function(a){this.c=a;};w.h=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i]=arguments[_i];}console.log.apply(console,[p.gray("["+this.c+"]")].concat(d));};w.j=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i]=arguments[_i];}if(this.b<exports.u.info){return;}console.log.apply(console,[p.gray("["+this.c+"]"+p.blue(" INFO: "))].concat(d));};w.k=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i]=arguments[_i];}if(this.b<exports.u.warn){return;}console.log.apply(console,["["+this.c+"]"+p.yellow(" WARNING: ")].concat(d));};w.l=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i]=arguments[_i];}if(this.b<exports.u.error){return;}console.log.apply(console,["["+this.c+"]"+p.red(" ERROR: ")].concat(d));};w.m=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i]=arguments[_i];}if(this.b<exports.u.error){return;}console.log.apply(console,["["+this.c+"]"+p.gray(" TRACE: ")].concat(d));};return w;}());w.b=exports.u.none;w.c="logger";exports.w=w;var TsCore;(function(TsCore){function g(c,d){var e=c.length;var f=d.length;return e>f&&c.substr(e-f,f)===d;}TsCore.g=g;TsCore.b=[".ts",".tsx",".d.ts"];TsCore.c=TsCore.b;function c(a){if(!a){return false;}for(var _i=0,b_1=TsCore.b;_i<b_1.length;_i++){var d=b_1[_i];if(g(a,d)){return true;}}return false;}TsCore.c=c;function d(b){var c=b.getDeclarations();if(c&&c.length>0){if(c[0].kind===a.SyntaxKind.SourceFile){return c[0].getSourceFile();}}return undefined;}TsCore.d=d;function c(b){if(b.kind===a.SyntaxKind.ImportDeclaration){return b.moduleSpecifier;}if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var e=b.moduleReference;if(e.kind===a.SyntaxKind.ExternalModuleReference){return e.expression;}}if(b.kind===a.SyntaxKind.ExportDeclaration){return b.moduleSpecifier;}}TsCore.c=c;function g(b){var c=[];for(var _i=1;_i<arguments.length;_i++){c[_i-1]=arguments[_i];}var f=b.message;if(arguments.length>1){f=h(f,arguments,1);}return {file:undefined,start:undefined,length:undefined,messageText:f,category:b.category,code:b.code};}TsCore.g=g;function h(a,b,c){c=c||0;return a.replace(/{(\d+)}/g,function(d,a){return b[+a+c];});}function c(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ImportClause&&!!b.name||b.kind===a.SyntaxKind.NamespaceImport||b.kind===a.SyntaxKind.ImportSpecifier||b.kind===a.SyntaxKind.ExportSpecifier||b.kind===a.SyntaxKind.ExportAssignment&&b.expression.kind===a.SyntaxKind.Identifier;}TsCore.c=c;function c(b){return b.replace(/\\/g,"/");}TsCore.c=c;function b(a){return a.replace(/\.ts/,".js");}TsCore.b=b;})(TsCore=exports.TsCore||(exports.TsCore={}));var Utils;(function(Utils){function e(b,d){if(b){for(var i=0,f=b.length;i<f;i++){var g=d(b[i],i);if(g){return g;}}}return undefined;}Utils.e=e;function c(a,b){if(a){for(var _i=0,a_1=a;_i<a_1.length;_i++){var v=a_1[_i];if(v===b){return true;}}}return false;}Utils.c=c;var b=Object.prototype.hasOwnProperty;function n(f,l){return b.call(f,l);}Utils.n=n;function c(a){var b={};for(var d in a){b[d]=a[d];}return b;}Utils.c=c;function d(b,f){var c;if(b){c=[];for(var _i=0,b_2=b;_i<b_2.length;_i++){var v=b_2[_i];c.push(f(v));}}return c;}Utils.d=d;function h(b,c){var d=1;var f={};for(var i in b){f[i]=b[i];}for(var j in c){if(!n(f,j)){f[j]=c[j];}}return f;}Utils.h=h;function e(b,c,d){return b.substr(0,c)+d+b.substr(c+d.length);}Utils.e=e;})(Utils=exports.Utils||(exports.Utils={}));var y=(function(){function y(c,d){this.b=c;this.f=d;}y.prototype.k=function(){return this.f;};y.prototype.l=function(){return this.b;};y.prototype.m=function(){return (this.b===a.ExitStatus.Success);};return y;}());exports.y=y;var z=(function(){function z(b){var _this=this;this.b={};this.d={};this.f=0;this.g={};this.i=0;this.l={};this.getSourceFile=this.t;this.fileExists=function(b){b=_this.getCanonicalFileName(b);if(!_this.directoryExists(r.dirname(b))){return false;}if(Utils.n(_this.g,b)){return _this.g[b];}_this.i++;return _this.g[b]=_this.p.fileExists(b);};this.o=b;this.p=a.createCompilerHost(this.o);}z.prototype.s=function(){return this.b;};z.prototype.t=function(c,e,h){return this.p.getSourceFile(c,e,h);};z.prototype.writeFile=function(d,f,g,i){this.b[d]=f;};z.prototype.readFile=function(a){if(Utils.n(this.l,a)){w.m("readFile() cache hit: ",a);return this.l[a];}w.m("readFile() Adding to cache: ",a);return this.l[a]=this.p.readFile(a);};z.prototype.getDefaultLibFileName=function(b){return this.p.getDefaultLibFileName(b);};z.prototype.getCurrentDirectory=function(){return this.p.getCurrentDirectory();};z.prototype.getDirectories=function(a){return this.p.getDirectories(a);};z.prototype.getCanonicalFileName=function(b){return this.p.getCanonicalFileName(b);};z.prototype.useCaseSensitiveFileNames=function(){return this.p.useCaseSensitiveFileNames();};z.prototype.getNewLine=function(){return this.p.getNewLine();};z.prototype.directoryExists=function(b){if(Utils.n(this.d,b)){return this.d[b];}this.f++;return this.d[b]=a.sys.directoryExists(b);};return z;}());exports.z=z;var A=(function(_super){__extends(A,_super);function A(a){return _super.call(this,{objectMode:true})||this;}A.prototype._read=function(){};return A;}(d.t));exports.A=A;var B=(function(){function B(){}B.prototype.a=function(b){w.h(b);};B.prototype.b=function(c,d){w.h(this.g(c+":",25)+p.magenta(this.f(d.toString(),10)));};B.prototype.c=function(a,e){this.b(a,""+e);};B.prototype.d=function(f,g){this.b(f,(g/1000).toFixed(2)+"s");};B.prototype.e=function(a,c){this.b(a,c.toFixed(2)+"%");};B.prototype.f=function(s,a){while(s.length<a){s=" "+s;}return s;};B.prototype.g=function(s,a){while(s.length<a){s=s+" ";}return s;};return B;}());exports.B=B;var C=(function(_super){__extends(C,_super);function C(a){return _super.call(this,a)||this;}return C;}(File));exports.C=C;var BundlePackageType;(function(BundlePackageType){BundlePackageType[BundlePackageType["None"]=0]="None";BundlePackageType[BundlePackageType["Library"]=1]="Library";BundlePackageType[BundlePackageType["Component"]=2]="Component";})(BundlePackageType=exports.BundlePackageType||(exports.BundlePackageType={}));var D=(function(){function D(a,d){this.c=undefined;this.b=a;this.c=d;}D.prototype.d=function(){return this.b;};D.prototype.e=function(){return this.c;};return D;}());exports.D=D;var E=(function(){function E(){}E.prototype.b=function(c,f){var i=[];return {bundles:b(),errors:i};function b(){var e=[];var h=c["bundles"];if(h){w.j(h);for(var k in h){w.j("Bundle Id: ",k,h[k]);var l=h[k];var m;var p=[];var q={};m=r.join(f,k);if(Utils.n(l,"files")){if(l["files"] instanceof Array){p=Utils.d(l["files"],function(s){return r.join(f,s);});w.j("bundle files: ",p);}else{i.push(TsCore.g({code:6063,category:a.DiagnosticCategory.Error,key:"Bundle_0_files_is_not_an_array_6063",message:"Bundle '{0}' files is not an array."},k));}}else{i.push(TsCore.g({code:6062,category:a.DiagnosticCategory.Error,key:"Bundle_0_requires_an_array_of_files_6062",message:"Bundle '{0}' requires an array of files."},k));}if(Utils.n(l,"config")){q=l.config;}q.package=t(q);e.push({name:m,fileNames:p,config:q});}}return e;}function t(b){var c=0;var d=undefined;var e={"none":0,"library":1,"component":2};if(Utils.n(b,"package")){var f=b["package"];if(typeof (f)==="string"){if(Utils.n(e,f.toLowerCase())){c=e[f.toLowerCase()];}}}if(Utils.n(b,"packageNamespace")){var g=b["packageNamespace"];if(typeof (g)==="string"){d=g;}}return new D(c,d);}};return E;}());exports.E=E;var F=(function(){function F(h,i,k){this.x=0;this.D=0;this.E=0;this.b=h;this.f=i;this.u=k;this.v=this.f.getCompilerOptions();}F.prototype.H=function(o){this.E=this.x=new Date().getTime();w.h("Compiling project files...");var q=a.getPreEmitDiagnostics(this.f);if(this.v.noEmitOnError&&q.length>0){return new y(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,q);}this.x=new Date().getTime()-this.x;if(!this.v.noEmit){var t=new Date().getTime();var z=this.f.emit();this.D=new Date().getTime()-t;q=q.concat(z.diagnostics);if(z.emitSkipped){return new y(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,q);}var A=this.b.s();for(var B in A){var G=A[B];var H=new C({path:B,contents:new Buffer(G)});this.u.F(H);}}this.E=new Date().getTime()-this.E;if(q.length>0){return new y(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,q);}if(this.v.diagnostics){this.M();}return new y(a.ExitStatus.Success);};F.prototype.M=function(){var b=new B();b.c("Files",this.f.getSourceFiles().length);b.c("Lines",this.R());b.d("Pre-emit time",this.x);b.d("Emit time",this.D);b.d("Compile time",this.E);};F.prototype.R=function(){var _this=this;var a=0;Utils.e(this.f.getSourceFiles(),function(b){if(!b.isDeclarationFile){a+=_this.T(b).length;}});return a;};F.prototype.T=function(b){return b.getLineStarts();};return F;}());exports.F=F;var G=(function(_super){__extends(G,_super);function G(b,c){var _this=_super.call(this,b)||this;_this.getSourceFile=function(b,c,d){if(_this.k){var f_1=_this.k.getSourceFile(b);if(f_1&&f_1.fileWatcher){w.m("getSourceFile() watcher hit for: ",b);return f_1;}}w.m("getSourceFile() reading source file from fs: ",b);var e=_super.prototype.t.call(_this,b,c,d);if(e&&_this.o.watch){e.fileWatcher=q.watch(e.fileName);e.fileWatcher.i("change",function(a,b){return _this.u(e,a,b);});}return e;};_this.u=c;return _this;}G.prototype.v=function(b){this.k=b;};return G;}(z));exports.G=G;var Ast;(function(Ast){function g(b){var f=a.ModifierFlags.None;if(b.modifiers){for(var _i=0,_a=b.modifiers;_i<_a.length;_i++){var h=_a[_i];f|=i(h.kind);}}return f;}Ast.g=g;function i(b){switch(b){case a.SyntaxKind.StaticKeyword:return a.ModifierFlags.Static;case a.SyntaxKind.PublicKeyword:return a.ModifierFlags.Public;case a.SyntaxKind.ProtectedKeyword:return a.ModifierFlags.Protected;case a.SyntaxKind.PrivateKeyword:return a.ModifierFlags.Private;case a.SyntaxKind.AbstractKeyword:return a.ModifierFlags.Abstract;case a.SyntaxKind.ExportKeyword:return a.ModifierFlags.Export;case a.SyntaxKind.DeclareKeyword:return a.ModifierFlags.Ambient;case a.SyntaxKind.ConstKeyword:return a.ModifierFlags.Const;case a.SyntaxKind.DefaultKeyword:return a.ModifierFlags.Default;case a.SyntaxKind.AsyncKeyword:return a.ModifierFlags.Async;case a.SyntaxKind.ReadonlyKeyword:return a.ModifierFlags.Readonly;}return a.ModifierFlags.None;}Ast.i=i;var ContainerFlags;(function(ContainerFlags){ContainerFlags[ContainerFlags["None"]=0]="None";ContainerFlags[ContainerFlags["IsContainer"]=1]="IsContainer";ContainerFlags[ContainerFlags["IsBlockScopedContainer"]=2]="IsBlockScopedContainer";ContainerFlags[ContainerFlags["IsControlFlowContainer"]=4]="IsControlFlowContainer";ContainerFlags[ContainerFlags["IsFunctionLike"]=8]="IsFunctionLike";ContainerFlags[ContainerFlags["IsFunctionExpression"]=16]="IsFunctionExpression";ContainerFlags[ContainerFlags["HasLocals"]=32]="HasLocals";ContainerFlags[ContainerFlags["IsInterface"]=64]="IsInterface";ContainerFlags[ContainerFlags["IsObjectLiteralOrClassExpressionMethod"]=128]="IsObjectLiteralOrClassExpressionMethod";ContainerFlags[ContainerFlags["IsContainerWithLocals"]=33]="IsContainerWithLocals";})(ContainerFlags=Ast.ContainerFlags||(Ast.ContainerFlags={}));function e(b){if(b.kind!==a.SyntaxKind.BinaryExpression){return false;}var c=b;if(c.operatorToken.kind!==a.SyntaxKind.EqualsToken||c.left.kind!==a.SyntaxKind.PropertyAccessExpression){return false;}var d=c.left;if(d.expression.kind===a.SyntaxKind.PropertyAccessExpression){var f=d.expression;if(f.expression.kind===a.SyntaxKind.Identifier&&f.name.text==="prototype"){return true;}}return false;}Ast.e=e;function c(b){if(b){switch(b.kind){case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.ArrowFunction:case a.SyntaxKind.MethodDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return true;}}return false;}Ast.c=c;function d(b){return b.kind===a.SyntaxKind.MethodDeclaration&&(b.parent.kind===a.SyntaxKind.ObjectLiteralExpression||b.parent.kind===a.SyntaxKind.ClassExpression);}Ast.d=d;function c(b){if(b&&(b.flags&a.SymbolFlags.Interface)){if(b.valueDeclaration){var f=b.valueDeclaration.flags;return false;}}return false;}Ast.c=c;function d(b){if(b&&(b.flags&a.SymbolFlags.Class)){var e=g(b.valueDeclaration);if(!(e&a.ModifierFlags.Export)){return true;}}return false;}Ast.d=d;function e(b){if(b&&b.valueDeclaration){if(g(b.valueDeclaration)&a.ModifierFlags.Abstract){return true;}}return false;}Ast.e=e;function o(b,f){var h=[];function e(b,c){var d=b.types;if(d){for(var _i=0,d_1=d;_i<d_1.length;_i++){var f=d_1[_i];var i=c.getTypeAtLocation(f);var k=i.symbol.valueDeclaration;if(k){var m=k.heritageClauses;if(m){for(var _a=0,m_1=m;_a<m_1.length;_a++){var n=m_1[_a];e(n,c);}}}var l=i.getProperties();for(var _b=0,l_1=l;_b<l_1.length;_b++){var o=l_1[_b];if(Ast.p(o)){h.push(o);}}}}}var l=b.heritageClauses;if(l){for(var _i=0,l_2=l;_i<l_2.length;_i++){var p=l_2[_i];e(p,f);}}return h;}Ast.o=o;function f(b,c){var d=[];var e=b.types;for(var _i=0,e_1=e;_i<e_1.length;_i++){var h=e_1[_i];var i=c.getTypeAtLocation(h);var j=i.getSymbol();if(j.valueDeclaration){if(g(j.valueDeclaration)&a.ModifierFlags.Abstract){var k=i.getProperties();for(var _a=0,k_1=k;_a<k_1.length;_a++){var l=k_1[_a];d.push(l);}}}}return d;}Ast.f=f;function g(b,c){var d=[];var e=b.types;for(var _i=0,e_2=e;_i<e_2.length;_i++){var h=e_2[_i];var i=c.getTypeAtLocation(h);var j=i.getProperties();for(var _a=0,j_1=j;_a<j_1.length;_a++){var k=j_1[_a];d.push(k);}}return d;}Ast.g=g;function d(b){if(!b){return undefined;}var c=b.id;if(c===undefined&&b.valueDeclaration){c=b.valueDeclaration.symbol.id;}return c?c.toString():undefined;}Ast.d=d;function e(b){switch(b.kind){case a.SyntaxKind.ClassExpression:case a.SyntaxKind.ClassDeclaration:case a.SyntaxKind.EnumDeclaration:case a.SyntaxKind.ObjectLiteralExpression:case a.SyntaxKind.TypeLiteral:case a.SyntaxKind.JSDocTypeLiteral:case a.SyntaxKind.JSDocRecordType:return 1;case a.SyntaxKind.InterfaceDeclaration:return 1|64;case a.SyntaxKind.JSDocFunctionType:case a.SyntaxKind.ModuleDeclaration:case a.SyntaxKind.TypeAliasDeclaration:return 1|32;case a.SyntaxKind.SourceFile:return 1|4|32;case a.SyntaxKind.MethodDeclaration:if(d(b)){return 1|4|32|8|128;}case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return 1|4|32|8;case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.ArrowFunction:return 1|4|32|8|16;case a.SyntaxKind.ModuleBlock:return 4;case a.SyntaxKind.PropertyDeclaration:return b.initializer?4:0;case a.SyntaxKind.CatchClause:case a.SyntaxKind.ForStatement:case a.SyntaxKind.ForInStatement:case a.SyntaxKind.ForOfStatement:case a.SyntaxKind.CaseBlock:return 2;case a.SyntaxKind.Block:return c(b.parent)?0:2;}return 0;}Ast.e=e;function c(b){if(b){var d=b.heritageClauses;if(d){for(var _i=0,d_2=d;_i<d_2.length;_i++){var e=d_2[_i];if(e.token===a.SyntaxKind.ImplementsKeyword){return e;}}}}return undefined;}Ast.c=c;function h(b){if(b){var i=b.heritageClauses;if(i){for(var _i=0,i_1=i;_i<i_1.length;_i++){var j=i_1[_i];if(j.token===a.SyntaxKind.ExtendsKeyword){return j;}}}}return undefined;}Ast.h=h;function c(b){return a.SyntaxKind.FirstKeyword<=b&&b<=a.SyntaxKind.LastKeyword;}Ast.c=c;function c(b){return a.SyntaxKind.FirstPunctuation<=b&&b<=a.SyntaxKind.LastPunctuation;}Ast.c=c;function c(b){return a.SyntaxKind.FirstTriviaToken<=b&&b<=a.SyntaxKind.LastTriviaToken;}Ast.c=c;function p(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.ExportContext){return true;}c=c.parent;}return false;}Ast.p=p;function d(b){var c=b.valueDeclaration;while(c){if(g(c)&a.ModifierFlags.Ambient){return true;}c=c.parent;}return false;}Ast.d=d;})(Ast=exports.Ast||(exports.Ast={}));var H=(function(){function H(){}H.prototype.a=function(b){var g=new t.Glob(b);var c=g.minimatch.set ;if(c.length>1)return true;for(var j=0;j<c[0].length;j++){if(typeof c[0][j]!=='string')return true;}return false;};H.prototype.b=function(d,f){if(d.length===0){return [];}var g=this.c(d,function(a){return t.sync(a,{root:f});});return g;};H.prototype.c=function(f,i){var k=[];_.flatten(f).forEach(function(b){var c;var a;c=_.isString(b)&&b.indexOf("!")===0;if(c){b=b.slice(1);}a=i(b);if(c){return k=_.difference(k,a);}else{return k=_.union(k,a);}});return k;};return H;}());exports.H=H;var I=(function(){function I(c,d,e){this.b=c;this.f=d;this.o=e;}I.prototype.q=function(){return this.o;};I.prototype.s=function(){return this.f;};I.prototype.t=function(){return this.b;};I.prototype.u=function(){return (this.b===a.ExitStatus.Success);};return I;}());exports.I=I;var J=(function(){function J(c,d){this.i={};this.b=c;this.f=d;this.h=this.f.getCompilerOptions();}J.prototype.l=function(f){var h=this;var i={};var k={};function d(c){c.forEach(function(e){var g=h.q(e);var l=h.s(g);var o=h.b.getCanonicalFileName(l.fileName);if(!Utils.n(k,o)){k[o]=true;if(!l.isDeclarationFile){w.j("Walking Import module: ",o);d(h.m(l));}}if(!Utils.n(i,o)){w.j("Getting and adding imports of module file: ",o);i[o]=h.m(l);}});}var o=h.m(f);d(o);var p=h.b.getCanonicalFileName(f.fileName);if(!Utils.n(i,p)){w.j("Adding top level import dependencies for file: ",p);i[p]=o;}return i;};J.prototype.m=function(b){var d=[];var e=this;function i(h){a.forEachChild(h,function(h){if(h.kind===a.SyntaxKind.ImportDeclaration||h.kind===a.SyntaxKind.ImportEqualsDeclaration||h.kind===a.SyntaxKind.ExportDeclaration){var l=TsCore.c(h);if(l&&l.kind===a.SyntaxKind.StringLiteral){var o=e.f.getTypeChecker().getSymbolAtLocation(l);if(o){w.j("Adding import node: ",o.name);d.push(h);}else{w.k("Module symbol not found");}}}else if(h.kind===a.SyntaxKind.ModuleDeclaration){var p=h;if((p.name.kind===a.SyntaxKind.StringLiteral)&&(Ast.g(p)&a.ModifierFlags.Ambient||b.isDeclarationFile)){w.j("Scanning for dependencies within ambient module declaration: ",p.name.text);i(p.body);}}});};w.j("Getting imports for source file: ",b.fileName);i(b);return d;};J.prototype.o=function(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration&&b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference;};J.prototype.p=function(b){return b.moduleReference.expression;};J.prototype.q=function(b){var d=TsCore.c(b);if(d&&d.kind===a.SyntaxKind.StringLiteral){return this.f.getTypeChecker().getSymbolAtLocation(d);}};J.prototype.s=function(b){var c=b.getDeclarations()[0];return c.getSourceFile();};return J;}());exports.J=J;var K=(function(){function K(c,d,e){this.q={};this.r=[];this.s=undefined;this.b=c;this.l=d;this.r=[c];this.q[e.f().toString()]=e;}K.prototype.t=function(){return this.l;};K.prototype.u=function(){return this.l.name;};K.prototype.v=function(){var b=this.l.id;if(b===undefined&&this.l.valueDeclaration){b=this.l.valueDeclaration.symbol.id;}return b?b.toString():undefined;};K.prototype.x=function(){return this.q;};K.prototype.y=function(){return this.r;};K.prototype.z=function(b,c){this.r.push(b);if(!Utils.n(this.q,c.f().toString())){this.q[c.f().toString()]=c;}};K.prototype.A=function(){if((this.l.flags&a.SymbolFlags.Alias)>0){if(this.l.declarations[0].kind===a.SyntaxKind.NamespaceImport){return true;}}return false;};K.prototype.C=function(){if((this.l.flags&a.SymbolFlags.FunctionScopedVariable)>0){var c=this.P();if(c){return true;}}return false;};K.prototype.D=function(){if((this.l.flags&a.SymbolFlags.BlockScopedVariable)>0){var b=this.P();if(b){return ((b.parent.flags&a.NodeFlags.Let)!==0)||((b.parent.flags&a.NodeFlags.Const)!==0);}}return false;};K.prototype.E=function(){if((this.l.flags&a.SymbolFlags.FunctionScopedVariable)>0){if(this.l.valueDeclaration.kind===a.SyntaxKind.Parameter){return true;}}return false;};K.prototype.F=function(){return Ast.d(this.l);};K.prototype.G=function(){return Ast.c(this.l);};K.prototype.H=function(b){if(this.l.flags&a.SymbolFlags.Function){if(this.l.valueDeclaration.kind===a.SyntaxKind.FunctionDeclaration){var c=Ast.g(this.l.valueDeclaration);if(Ast.p(this.l)||Ast.d(this.l)){return false;}if(!(c&a.ModifierFlags.Export)){return true;}if(b){var e=this.l.valueDeclaration;while(e){if(e.flags&a.NodeFlags.Namespace){var f=e.name.text;if(f!==b){return true;}}e=e.parent;}}}}return false;};K.prototype.I=function(){if((this.l.flags&a.SymbolFlags.Method)>0){if(this.l.valueDeclaration===undefined){return false;}var b=Ast.g(this.l.valueDeclaration);if((b&a.ModifierFlags.Private)>0){return true;}var f_2=this.l.parent;if(f_2&&Ast.d(f_2)){if(!Ast.e(f_2)){return true;}}if(f_2&&Ast.c(f_2)){return false;}}return false;};K.prototype.J=function(){if((this.l.flags&a.SymbolFlags.Property)>0){if(this.l.valueDeclaration===undefined){return false;}var b=Ast.g(this.l.valueDeclaration);if((b&a.ModifierFlags.Private)>0){return true;}var c_1=this.l.parent;if(c_1&&Ast.d(c_1)){if(!Ast.e(c_1)){return true;}}}return false;};K.prototype.P=function(){switch(this.b.parent.kind){case a.SyntaxKind.VariableDeclaration:return this.b.parent;case a.SyntaxKind.VariableDeclarationList:w.k("VariableDeclaratioList in getVariableDeclaration() - returning null");break;case a.SyntaxKind.VariableStatement:w.k("VariableStatement in getVariableDeclaration() - returning null");break;}return null;};return K;}());exports.K=K;var M=(function(){function M(){}M.c=function(){return this.b++;};return M;}());M.b=1;var L=(function(){function L(d,e,f){this.A=[];this.C=undefined;this.F={};this.G={};this.H={};this.I={};this.J=[];this.N=0;this.b=M.c();this.q=e;if(e&2){this.p=d;this.B=true;this.r=f.Q();}else{this.l=this.p=d;this.B=false;this.r=this;}this.E=0;}L.prototype.f=function(){return this.b;};L.prototype.O=function(b){this.A.push(b);};L.prototype.P=function(){return this.A;};L.prototype.Q=function(){return this.r;};L.prototype.R=function(){if(this.B){return this.r.R();}return this.E++;};L.prototype.S=function(){return this.B?this.p:this.l;};L.prototype.T=function(){if(this.l){switch(this.l.kind){case a.SyntaxKind.ClassDeclaration:return this.l.members;case a.SyntaxKind.EnumDeclaration:return this.l.members;default:w.m("Container::getMembers() unprocessed container kind: ",this.l.kind);}}return undefined;};L.prototype.U=function(){if(this.l&&this.q&32){switch(this.l.kind){case a.SyntaxKind.ModuleDeclaration:return this.l.locals;default:w.k("Container::getLocals() unprocessed container kind: ",this.l.kind);}}return undefined;};L.prototype.V=function(){return this.B;};L.prototype.W=function(){if(this.q&(1|33)){return true;}return false;};L.prototype.X=function(b){if(b.flags&a.SymbolFlags.Class){this.C=b;}};L.prototype.Y=function(){return this.C;};L.prototype.Z=function(a){for(var i=0;i<this.A.length;i++){if(a.f()===this.A[i].f())return true;}return false;};return L;}());exports.L=L;var N=(function(){function N(){}N.prototype.b=function(c){this.l(c);};N.prototype.l=function(b){this.p(b);};N.prototype.p=function(b){var _this=this;a.forEachChild(b,function(a){return _this.l(a);});};return N;}());exports.N=N;var O=(function(){function O(){this.p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_0123456789";}O.prototype.q=function(a){var b=["do","if","in","for","int","let","new","try","var"];var c;while(true){c=this.r(a++);if(b.indexOf(c)>0){continue;}else{return c;}}};O.prototype.r=function(a){var b=a;var c=this.p[b%54];b=Math.floor(b/54);while(b>0){c+=this.p[b%64];b=Math.floor(b/64);}return c;};return O;}());exports.O=O;var Debug;(function(Debug){function c(a,b){if(!a){b=b||"Assertion failed";if(typeof Error!=="undefined"){throw new Error(b);}throw b;}}Debug.c=c;})(Debug=exports.Debug||(exports.Debug={}));var P=(function(_super){__extends(P,_super);function P(b,c,d){var _this=_super.call(this)||this;_this._=[];_this.ab={};_this.bb={};_this.ib=0;_this.jb=0;_this.V=b;_this.W=b.getTypeChecker();_this.Z=c;_this.$=d;_this._=[];_this.db=new O();return _this;}P.prototype.transform=function(d){this.M=d;return this.nb(d);};P.prototype.kb=function(b){this.gb=new Date().getTime();this.eb=b.length;var f="";var k=a.SyntaxKind.Unknown;var m=false;var o;var p=a.createScanner(a.ScriptTarget.ES5,false,a.LanguageVariant.Standard,b);while((o=p.scan())!==a.SyntaxKind.EndOfFileToken){m=false;if(Ast.c(o)){m=true;}if(!m){switch(k){case a.SyntaxKind.FunctionKeyword:if(o===a.SyntaxKind.Identifier){f+=" ";}break;case a.SyntaxKind.BreakKeyword:case a.SyntaxKind.ContinueKeyword:case a.SyntaxKind.ReturnKeyword:case a.SyntaxKind.YieldKeyword:if(o!==a.SyntaxKind.SemicolonToken){f+=" ";}break;case a.SyntaxKind.ElseKeyword:if(o!==a.SyntaxKind.OpenBraceToken){f+=" ";}break;}switch(o){case a.SyntaxKind.CaseKeyword:case a.SyntaxKind.ClassKeyword:case a.SyntaxKind.ConstKeyword:case a.SyntaxKind.DeleteKeyword:case a.SyntaxKind.DoKeyword:case a.SyntaxKind.ExportKeyword:case a.SyntaxKind.GetKeyword:case a.SyntaxKind.ImportKeyword:case a.SyntaxKind.LetKeyword:case a.SyntaxKind.NewKeyword:case a.SyntaxKind.SetKeyword:case a.SyntaxKind.StaticKeyword:case a.SyntaxKind.ThrowKeyword:case a.SyntaxKind.TypeOfKeyword:case a.SyntaxKind.VarKeyword:case a.SyntaxKind.VoidKeyword:f+=p.getTokenText()+" ";break;case a.SyntaxKind.ExtendsKeyword:case a.SyntaxKind.InKeyword:case a.SyntaxKind.InstanceOfKeyword:f+=" "+p.getTokenText()+" ";break;case a.SyntaxKind.PlusToken:case a.SyntaxKind.PlusPlusToken:if((k===a.SyntaxKind.PlusToken)||(k===a.SyntaxKind.PlusPlusToken)){f+=" ";}f+=p.getTokenText();break;case a.SyntaxKind.MinusToken:case a.SyntaxKind.MinusMinusToken:if((k===a.SyntaxKind.MinusToken)||(k===a.SyntaxKind.MinusMinusToken)){f+=" ";}f+=p.getTokenText();break;default:f+=p.getTokenText();break;}}if(!m){k=o;}}this.fb=f.length;this.gb=new Date().getTime()-this.gb;if(this.Z.diagnostics)this.Cb();return f;};P.prototype.lb=function(b){if(this.Bb(b)){_super.prototype.l.call(this,b);this.Ab();}else{switch(b.kind){case a.SyntaxKind.Identifier:var c=b;var e=this.W.getSymbolAtLocation(c);if(!e){e=this.mb(c);}if(e){var f=Ast.d(e);if(f===undefined){if(e.flags&a.SymbolFlags.Transient){w.m("Ignoring transient symbol: ",e.name);break;}else{f=a.getSymbolId(e).toString();w.m("Generated symbol id for: ",e.name,f);}}if(Utils.n(this.bb,f)){w.j("Identifier already added: ",e.name,f);var g=this.bb[f];this.bb[f].z(c,this.zb());if(!Utils.n(this.zb().G,f)){this.zb().I[f]=g;}}else{var h=new K(c,e,this.zb());w.j("Adding new identifier: ",h.u(),h.v());this.zb().G[f]=h;this.bb[f]=h;var i=e.getName();if(i.length===1){h.s=i;this.zb().I[f]=h;}this.ib++;}}else{w.k("Identifier does not have a symbol: ",c.text);}break;}_super.prototype.l.call(this,b);}};P.prototype.mb=function(b){var c=this.zb().S();if(c.kind===a.SyntaxKind.FunctionExpression){if(Ast.e(c.parent)){var d=c.parent.left.expression.expression;var f=this.W.getSymbolAtLocation(d);if(f&&f.members){if(f.members.has[b.text]){w.j("Symbol obtained from prototype function: ",b.text);return f.members[b.text];}}}}return undefined;};P.prototype.nb=function(e){this.hb=new Date().getTime();this.b(e);this.ob();this.hb=new Date().getTime()-this.hb;if(this.Z.diagnostics)this.Db();return e;};P.prototype.ob=function(){for(var b in this.ab){var d=this.ab[b];var e=[];var i=[];var j=[];var k=Ast.h(d.S());if(k){e=Ast.f(k,this.W);}var l=Ast.c(d.S());if(l){j=Ast.g(l,this.W);}i=Ast.o(d.S(),this.W);var m=i.concat(e,j);d.J=m;}this.pb(this.cb);};P.prototype.pb=function(a){var b=a.Y();if(b){var h=this.ab[b.name];if(h){var i=h.T();if(i){this.vb(i,h);}}}this.wb(a);var e=a.T();if(e){this.vb(e,a);}var f=a.U();if(f){this.ub(f,a);}for(var k in a.G){var l=a.G[k];this.qb(l,a);}for(var m in a.H){var n=a.H[m];var o=Ast.d(n);var p=this.bb[o];this.qb(p,a);}var g=a.P();for(var j=0;j<g.length;j++){this.pb(g[j]);}};P.prototype.qb=function(a,b){var _this=this;if(this.rb(a)){var d_3=this.sb(b,a);w.m("Identifier shortened: ",a.u(),d_3);var f=a.x();for(var g in f){var h=f[g];h.F[d_3]=true;}Utils.e(a.y(),function(b){_this.tb(b,d_3);});return;}};P.prototype.rb=function(a){if(a.D()||a.C()||a.F()||a.G()||a.I()||a.J()||a.H(this.$.package.e())||a.E()||a.A()){w.m("Identifier CAN be shortened: ",a.u());return true;}w.m("Identifier CANNOT be shortened: ",a.u());return false;};P.prototype.sb=function(a,b){if(!b.s){var d=b.u();if(d.length===1){b.s=d;}else{while(true){var e=this.db.q(a.R());Debug.c(e.length<=d.length);if(!Utils.n(a.F,e)){b.s=e;break;}else{w.m("Generated name was excluded: ",e,d);}}this.jb++;}}else{w.m("Identifier already has shortened name: ",b.u(),b.s);}w.j("Identifier shortened name: ",b.u(),b.s);return b.s;};P.prototype.tb=function(b,f){var g=b.text.length;var h=(b.end-b.pos);var k=b.getLeadingTriviaWidth();for(var l=b.pos+k;l<b.pos+h;l++){if(this.M.text[l]===b.text[0])break;}b.text=f;b.end=l+f.length;for(var i=0;i<g;i++){var m=" ";if(i<f.length){m=f[i];}this.M.text=Utils.e(this.M.text,l+i,m);}};P.prototype.ub=function(b,c){for(var e in b){var f=b[e];var g=Ast.d(f.declarations[0].symbol);if(g){var h=this.bb[g];this.qb(h,c);}else{w.k("Container local does not have a UId");}}};P.prototype.vb=function(b,c){for(var e in b){var f=b[e];var g=f.symbol;if(g){var h=Ast.d(g);if(h){var i=this.bb[h];var j=false;for(var l in c.J){var m=i.t();var n=c.J[l];if(m.name===n.name){j=true;i.s=i.u();break;}}if(!j){this.qb(i,c);}}else{w.k("Container member does not have a UId");}}else{w.k("Container member does not have a symbol.");}}};P.prototype.wb=function(a){var b=a.Y();if(b){var e=this.ab[b.name];if(e){var f=e.T();if(f){for(var g in f){var h=f[g];var i=h.symbol;var j=Ast.d(i);var k=this.bb[j];if(k&&k.s){a.F[k.s]=true;}}}}}for(var l in a.G){var m=a.G[l];this.yb(m,a);}for(var n in a.H){var o=a.H[n];var p=Ast.d(o);var q=this.bb[p];Debug.c(q!==undefined,"Container classifiable identifier symbol not found.");this.yb(q,a);}};P.prototype.xb=function(b){var d=this.Z.target;var f={};function e(b){var c=b.P();for(var i=0;i<c.length;i++){var g=c[i];e(g);}for(var h in b.I){var j=b.I[h];if((!j.D)||(d===a.ScriptTarget.ES5)){if(!Utils.n(f,j.v())){f[j.v()]=j;}}}}e(b.Q());return f;};P.prototype.yb=function(a,b){var c=a.x();for(var d in c){var e=c[d];var f=this.xb(e);for(var g in f){var h=f[g];if(h.s){b.F[h.s]=true;}}}};P.prototype.zb=function(){return this._[this._.length-1];};P.prototype.Ab=function(){return this._.pop();};P.prototype.Bb=function(b){var c=Ast.e(b);if(c&(1|2)){var f=new L(b,c,this.zb());var g=b.symbol;if(g&&(g.flags&a.SymbolFlags.Class)){var j=Ast.d(g);if(!Utils.n(this.zb().H,j)){this.zb().H[j]=g;}if(!Utils.n(this.ab,g.name)){this.ab[g.name]=f;}var k=Ast.h(b);if(k){var l=this.W.getSymbolAtLocation(k.types[0].expression);f.X(l);}}var i=this.zb();if(!i){this.cb=f;}else{i.O(f);}this._.push(f);return true;}return false;};P.prototype.Cb=function(){var a=new B();a.d("Whitespace time",this.gb);a.e("Whitespace reduction",((this.eb-this.fb)/this.eb)*100.00);};P.prototype.Db=function(){var a=new B();a.d("Minify time",this.hb);a.c("Total identifiers",this.ib);a.c("Identifiers shortened",this.jb);};return P;}(N));exports.P=P;var Q=(function(){function Q(){}Q.b=function(c){if(!c){return;}for(var i=0;i<c.length;i++){this.c(c[i]);}};Q.c=function(b){if(!b){return;}var d="";if(b.file){var f=a.getLineAndCharacterOfPosition(b.file,b.start);d+=p.gray(b.file.fileName+"("+(f.line+1)+","+(f.character+1)+"): ");}var e;switch(b.category){case a.DiagnosticCategory.Error:e=p.red(a.DiagnosticCategory[b.category].toLowerCase());break;case a.DiagnosticCategory.Warning:e=p.yellow(a.DiagnosticCategory[b.category].toLowerCase());break;default:e=p.green(a.DiagnosticCategory[b.category].toLowerCase());}d+=e+" TS"+p.white(b.code+'')+": "+p.grey(a.flattenDiagnosticMessageText(b.messageText,"\n"));w.h(d);};return Q;}());exports.Q=Q;var R=(function(){function R(d,g,j){this.f=d;this.C(j);this.t=g;}R.prototype.y=function(){this.t.compilerOptions.watch||false;};R.prototype.z=function(){return this.n;};R.prototype.C=function(b){if(this.n){var d_4=b?b.getSourceFiles():undefined;Utils.e(this.n.getSourceFiles(),function(a){if(!(d_4&&Utils.c(d_4,a))){var b=a;if(b.fileWatcher){b.fileWatcher.e(b.fileName);}}});}this.f.v(b);this.n=b;};return R;}());exports.R=R;var S=(function(){function S(b,c){this.y=0;this.A=0;this.D=0;this.E=0;this.K="";this.L="";this.N={};this.O={};this.P={};this.v=b;this.x=c;}S.prototype.R=function(B){var _this=this;this.o=B;this.E=new Date().getTime();var D=new J(this.v,this.x);var G=r.dirname(B.name);if(B.config.outDir){G=r.join(G,B.config.outDir);}var M=r.join(G,r.basename(B.name));M=TsCore.c(M);this.K="";this.L="";this.N={};this.O={};this.P={};var T=false;var U={};var _loop_1=function(){var $=B.fileNames[Z];w.j(">>> Processing bundle file:",$);var _=this_1.v.getCanonicalFileName(TsCore.c($));w.j("BundleSourceFileName:",_);var bb=this_1.x.getSourceFile(_);if(!bb){var eb=TsCore.g({code:6060,category:a.DiagnosticCategory.Error,key:"Bundle_source_file_0_not_found_6060",message:"Bundle source file '{0}' not found."},_);return {value:new I(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,[eb])};}if(bb.languageVariant==a.LanguageVariant.JSX){T=true;}var cb=new Date().getTime();var db=D.l(bb);this_1.y+=new Date().getTime()-cb;for(var fb in db){if(!Utils.n(U,fb)){U[fb]=db[fb];}}cb=new Date().getTime();w.j("Traversing module dependencies for bundle: ",bb.fileName);for(var gb in db){w.j("Walking dependency nodes for module: ",gb);hb=db[gb];hb.forEach(function(b){var e=_this.eb(b);var f=TsCore.d(e);if(f&&!f.isDeclarationFile){var g=_this.v.getCanonicalFileName(f.fileName);var h=db[g];if(h){_this.T(b,h);}if(!Utils.n(_this.N,g)){_this.ab(f);}}else{if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var i=b.name.text;var j=_this.W(b);if(_this.X(j,i)){_this._(b.getText());}}else{if(b.kind===a.SyntaxKind.ImportDeclaration){_this.Y(b);}}}});}this_1.ab(bb);this_1.A+=new Date().getTime()-cb;};var this_1=this,hb;for(var Z in B.fileNames){var state_1=_loop_1();if(typeof state_1==="object")return state_1.value;}var W=this.L;if(B.config.package.d()===1){W+="export namespace "+B.config.package.e()+" {\r\n";W+=this.K;W+=" \r\n}";}else{W+=this.K;}var X=T?".tsx":".ts";var Y={path:M+X,extension:X,text:W};this.E=new Date().getTime()-this.E;if(this.x.getCompilerOptions().diagnostics){this.gb();}return new I(a.ExitStatus.Success,undefined,Y);};S.prototype.T=function(b,c){for(var _i=0,c_2=c;_i<c_2.length;_i++){var e=c_2[_i];var f=this.eb(e);var g=TsCore.d(f);if(g&&!g.isDeclarationFile){var h=this.v.getCanonicalFileName(g.fileName);var i=this.fb(e);if(this.U(b,i)){if(!Utils.n(this.N,h)){this.ab(g);}}}}};S.prototype.U=function(b,c){var d=this.eb(b);var e=this.x.getTypeChecker().getExportsOfModule(d);for(var _i=0,e_3=e;_i<e_3.length;_i++){var f=e_3[_i];var g=this.x.getTypeChecker().getDeclaredTypeOfSymbol(f);var h=this.x.getTypeChecker().getBaseTypes(g);for(var _a=0,h_1=h;_a<h_1.length;_a++){var i=h_1[_a];var k=i.symbol.getName();if(c.indexOf(k)>=0){w.j("Base class inheritance found",k);return true;}}}return false;};S.prototype.W=function(b){if(b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference){var c=b.moduleReference;return c.expression.text;}else{return b.moduleReference.getText();}};S.prototype.X=function(a,b){if(!Utils.n(this.O,a)){this.O[a]={};}var c=this.O[a];if(!Utils.n(c,b)){c[b]=b;return true;}return false;};S.prototype.Y=function(b){var _this=this;if(!b.importClause){return;}var c=b.moduleSpecifier.text;var d="import ";var f=false;var g=false;if(b.importClause){if(b.importClause.name&&this.X(c,b.importClause.name.text)){d+=b.importClause.name.text;f=true;}}if(b.importClause.namedBindings){if(b.importClause.namedBindings.kind===a.SyntaxKind.NamespaceImport){if(this.X(c,b.importClause.namedBindings.name.text)){if(f){d+=", ";}d+="* as ";d+=b.importClause.namedBindings.name.text;g=true;}}else{if(f){d+=", ";}d+="{ ";Utils.e(b.importClause.namedBindings.elements,function(a){if(_this.X(c,a.name.text)){if(!g){g=true;}else{d+=", ";}var b=a.propertyName;if(b){d+=b.text+" as "+a.name.text;}else{d+=a.name.text;}}});d+=" }";}}d+=" from ";d+=b.moduleSpecifier.getText();d+=";";if(f||g){this._(d);}};S.prototype.Z=function(b){var _this=this;w.j("Processing import statements and export declarations in file: ",b.fileName);var f=b.text;a.forEachChild(b,function(b){if(b.kind===a.SyntaxKind.ImportDeclaration||b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ExportDeclaration){w.j("processImportStatements() found import");var g=TsCore.c(b);if(g&&g.kind===a.SyntaxKind.StringLiteral){var h=_this.x.getTypeChecker().getSymbolAtLocation(g);if((h)&&(_this.cb(h)||_this.db)){w.j("processImportStatements() removing code module symbol.");f=_this.$(b.pos,b.end,f);}}}else{if(_this.o.config.package.d()===2){if(b.kind===a.SyntaxKind.ModuleDeclaration){var i_2=b;if(i_2.name.getText()!==_this.o.config.package.e()){if(i_2.flags&a.NodeFlags.ExportContext){w.j("Component namespace not package namespace. Removing export modifier.");var k=i_2.modifiers[0];f=_this.$(k.pos,k.end,f);}}}else{if(b.flags&a.NodeFlags.ExportContext){var l=b.modifiers[0];f=_this.$(l.pos,l.end,f);}}}}});return f;};S.prototype.$=function(a,b,c){var d=b-a;var e="";for(var i=0;i<d;i++){e+=" ";}var f=c.substring(0,a);var g=c.substring(b);return f+e+g;};S.prototype._=function(a){w.j("Entering emitModuleImportDeclaration()");this.L+=a+"\n";};S.prototype.ab=function(b){w.j("Entering addSourceFile() with: ",b.fileName);if(this.bb(b)){var c=this.Z(b);this.K+=c+"\n";var d=this.v.getCanonicalFileName(b.fileName);this.N[d]=d;}else{if(!Utils.n(this.P,b.fileName)){w.j("Adding definition file to bundle source context: ",b.fileName);this.P[b.fileName]=b.text;}}};S.prototype.bb=function(b){return (b.kind===a.SyntaxKind.SourceFile&&!b.isDeclarationFile);};S.prototype.cb=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.SourceFile)&&!(c.isDeclarationFile));};S.prototype.db=function(b){var c=b.getDeclarations();if(c&&c.length>0){var d=b.getDeclarations()[0];if(d.kind===a.SyntaxKind.ModuleDeclaration){if(d.modifiers){for(var _i=0,_a=d.modifiers;_i<_a.length;_i++){var e=_a[_i];if(e.kind===a.SyntaxKind.DeclareKeyword){return true;}}}}}return false;};S.prototype.eb=function(b){var d=TsCore.c(b);if(d&&d.kind===a.SyntaxKind.StringLiteral){return this.x.getTypeChecker().getSymbolAtLocation(d);}};S.prototype.fb=function(b){var c=[];var d=b.importClause.namedBindings;if(d){switch(d.kind){case a.SyntaxKind.NamespaceImport:break;case a.SyntaxKind.NamedImports:for(var _i=0,_a=d.elements;_i<_a.length;_i++){var e=_a[_i];c.push(e.getText());}break;}}return c;};S.prototype.gb=function(){var a=new B();a.d("Deps gen time",this.y);a.d("Deps walk time",this.A);a.d("Source gen time",this.E);};return S;}());exports.S=S;var V=(function(){function V(b,c,d){this.D=0;this.E=0;this.J=0;this.K={};this.g=b;this.o=c;this.v=d;this.x=this.o.getCompilerOptions();}V.prototype.L=function(A,G){var _this=this;w.h("Compiling bundle...");this.E=this.J=new Date().getTime();var N;var O;var T;var U=[];Utils.e(this.o.getSourceFiles(),function(a){U.push(a.fileName);});var W={};var X;var Y=G.minify||false;if(Y){var jb_1=r.dirname(A.path);var lb_1=r.basename(A.path,A.extension);N=TsCore.c(r.join(jb_1,lb_1+".min.ts"));}else{N=A.path;}O=A.text;this.K[N]=O;T=a.createSourceFile(N,A.text,this.x.target);U.push(N);Utils.e(this.o.getSourceFiles(),function(a){_this.K[a.fileName]=a.text;});function k(b,d,f,i){W[b]=d;}function l(b,d,f){if(b===N){return T;}var i=X(b,d,f);return i;}X=this.g.getSourceFile;this.g.getSourceFile=l;this.g.writeFile=k;var Z=this.x;Z.declaration=G.declaration||this.x.declaration;Z.sourceMap=G.sourceMap||this.x.sourceMap;Z.noEmit=false;if(Y){Z.declaration=false;Z.removeComments=true;}var $=a.createProgram(U,Z,this.g);var _=a.getPreEmitDiagnostics($);this.J=new Date().getTime()-this.J;if(this.x.noEmitOnError&&_.length>0){return new y(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,_);}if(Y){w.h("Minifying bundle...");var mb=new P($,Z,G);T=mb.transform(T);}this.D=new Date().getTime();var ab=$.emit(T);this.D=new Date().getTime()-this.D;w.j("Streaming vinyl bundle source: ",N);var bb=new C({path:N,contents:new Buffer(T.text)});this.v.F(bb);var cb=_.concat(ab.diagnostics);if(ab.emitSkipped){return new y(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,cb);}if(this.x.noEmitOnError&&cb.length>0){return new y(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,cb);}var db=r.dirname(A.path);var eb=r.basename(A.path,A.extension);var fb=Y?".min":"";var gb=TsCore.c(r.join(db,eb+fb+".js"));if(Utils.n(W,gb)){var nb=W[gb];if(Y){var pb=new P($,Z,G);nb=pb.kb(nb);}w.j("Streaming vinyl js: ",eb);var ob=new C({path:gb,contents:new Buffer(nb)});this.v.F(ob);}var hb=TsCore.c(r.join(db,eb+fb+".d.ts"));if(Utils.n(W,hb)){w.j("Streaming vinyl d.ts: ",hb);var qb=new C({path:hb,contents:new Buffer(W[hb])});this.v.F(qb);}var ib=TsCore.c(r.join(db,eb+fb+".js.map"));if(Utils.n(W,ib)){w.j("Streaming vinyl js.map: ",ib);var rb=new C({path:ib,contents:new Buffer(W[ib])});this.v.F(rb);}this.E=new Date().getTime()-this.E;if(this.x.diagnostics)this.M();if(cb.length>0){return new y(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,cb);}else{return new y(a.ExitStatus.Success);}};V.prototype.M=function(){var a=new B();a.d("Pre-emit time",this.J);a.d("Emit time",this.D);a.d("Compile time",this.E);};return V;}());exports.V=V;var W=(function(){function W(a,b){var _this=this;this.J=0;this.K=0;this.M=0;this.N=0;this.bb=function(a,b){_this.O=undefined;_this.db();};this.cb=function(a,b,c){a.fileWatcher.e(a.fileName);a.fileWatcher=undefined;_this.db();};this.eb=function(){_this.T=undefined;var a=_this.$();_this.jb(a);if(_this.O.t.compilerOptions.watch){w.h("Watching for project changes...");}};this.n=a;this.v=b;}W.prototype.U=function(c){var B=this.ab();if(!B.success){Q.b(B.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.O=this.X(B);w.h("Building Project with: "+p.magenta(""+this.D));w.h("TypeScript compiler version: ",a.version);this.x=c;var P=this.$();this.jb(P);if(B.compilerOptions.watch){w.h("Watching for project changes...");}else{this.Z();}return P;};W.prototype.X=function(U){if(U.compilerOptions.watch){if(!this.Y()){U.compilerOptions.watch=false;}}var W=new G(U.compilerOptions,this.cb);return new R(W,U);};W.prototype.Y=function(){var _this=this;if(!a.sys.watchFile){var b=TsCore.g({code:5001,category:a.DiagnosticCategory.Warning,key:"The_current_node_host_does_not_support_the_0_option_5001",message:"The current node host does not support the '{0}' option."},"-watch");Q.c(b);return false;}if(!this.P){this.P=q.watch(this.D);this.P.i("change",function(W,lb){return _this.bb(W,lb);});}return true;};W.prototype.Z=function(){this.x.F(null);};W.prototype.$=function(){this.J=this.M=new Date().getTime();if(!this.O){var B=this.ab();if(!B.success){Q.b(B.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.O=this.X(B);}var c=[];var d=this.O.t.fileNames;var g=this.O.t.bundles;var j=this.O.t.compilerOptions;var n=a.createProgram(d,j,this.O.f,this.O.z());this.M=new Date().getTime()-this.M;this.O.C(n);var o=new F(this.O.f,n,this.x);this.K=new Date().getTime();var r=o.H();this.K=new Date().getTime()-this.K;if(!r.m()){Q.b(r.k());return r.l();}if(j.listFiles){Utils.e(this.O.z().getSourceFiles(),function(a){w.h(a.fileName);});}this.N=new Date().getTime();var v=new S(this.O.f,this.O.z());var y=new V(this.O.f,this.O.z(),this.x);var A;for(var i=0,D=g.length;i<D;i++){w.h("Building bundle: ",p.cyan(g[i].name));A=v.R(g[i]);if(!A.u()){Q.b(A.s());return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}r=y.L(A.q(),g[i].config);if(!r.m()){Q.b(r.k());return r.l();}}this.N=new Date().getTime()-this.N;this.J=new Date().getTime()-this.J;if(j.diagnostics){this.kb();}if(c.length>0){return a.ExitStatus.DiagnosticsPresent_OutputsGenerated;}return a.ExitStatus.Success;};W.prototype.ab=function(){var _this=this;try{var p=o.lstatSync(this.n).isDirectory();}catch(e){var q=TsCore.g({code:6064,category:a.DiagnosticCategory.Error,key:"Cannot_read_project_path_0_6064",message:"Cannot read project path '{0}'."},this.n);return {success:false,errors:[q]};}if(p){this.y=this.n;this.D=r.join(this.n,"tsconfig.json");}else{this.y=r.dirname(this.n);this.D=this.n;}w.j("Reading config file:",this.D);var c=a.readConfigFile(this.D,this.fb);if(c.error){return {success:false,errors:[c.error]};}var d=c.config;w.j("Parsing config file...");var f=a.parseJsonConfigFileContent(d,a.sys,this.y);if(f.errors.length>0){return {success:false,errors:f.errors};}f.fileNames=this.hb(f.fileNames,this.y);if(this.v.convertFiles===true){this.ib(f.fileNames,this.y);}var i=new E();var k=i.b(d,this.y);if(k.errors.length>0){return {success:false,errors:k.errors};}k.bundles.forEach(function(a){a.fileNames=_this.hb(a.fileNames,_this.y);});var l=this.gb(this.v,this.y);if(l.errors.length>0){return {success:false,errors:l.errors};}var m=Utils.h(l.options,f.options);w.j("Compiler options: ",m);return {success:true,compilerOptions:m,fileNames:f.fileNames,bundles:k.bundles};};W.prototype.db=function(){if(this.T){clearTimeout(this.T);}this.T=setTimeout(this.eb,250);};W.prototype.fb=function(b){return a.sys.readFile(b);};W.prototype.gb=function(b,c){var d=a.parseJsonConfigFileContent(b,a.sys,c);if(d.options.project){var e=TsCore.g({code:5099,category:a.DiagnosticCategory.Error,key:"The_compiler_option_0_is_not_supported_in_this_context_5099",message:"The compiler option '{0}' is not supported in this context."},"--project");d.errors.push(e);}return d;};W.prototype.hb=function(c,d){var f=new H();var g=[];Utils.e(c,function(b){if(!f.a(b)){g.push(r.normalize(b));}});var h=f.b(c,d);var i=[];Utils.e(h,function(a){i.push(r.normalize(a));});return _.union(i,g);};W.prototype.ib=function(a,b){var c="";try{c=o.readFileSync(this.D,'utf8');if(c!==undefined){var d=JSON.parse(c);var f_3=[];a.forEach(function(a){f_3.push(r.relative(b,a).replace(/\\/g,"/"));});d["files"]=f_3;o.writeFileSync(this.D,JSON.stringify(d,undefined,4));}}catch(e){w.h(p.yellow("Converting project files failed."));}};W.prototype.jb=function(b){switch(b){case a.ExitStatus.Success:w.h(p.green("Project build completed successfully."));break;case a.ExitStatus.DiagnosticsPresent_OutputsSkipped:w.h(p.red("Build completed with errors."));break;case a.ExitStatus.DiagnosticsPresent_OutputsGenerated:w.h(p.red("Build completed with errors. "+p.italic("Outputs generated.")));break;}};W.prototype.kb=function(){var b=new B();b.a("Total build times...");b.d("Pre-build time",this.M);b.d("Compiling time",this.K);b.d("Bundling time",this.N);b.d("Build time",this.J);};return W;}());exports.W=W;var TsProject;(function(TsProject){function h(a,b){if(a===undefined&&typeof a!=='string'){throw new Error("Provide a valid directory or file path to the Typescript project configuration json file.");}b=b||{};b.logLevel=b.logLevel||0;w.f(b.logLevel);w.g("TsProject");var c=new A();var e=new W(a,b);e.U(c);return c;}TsProject.h=h;})(TsProject=exports.TsProject||(exports.TsProject={}));module.exports=TsProject;